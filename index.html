<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TONFiles Market</title>
  <style>
    :root {
      --bg: #0f1220;
      --card: #171a2a;
      --text: #e8ebff;
      --muted: #9aa3c7;
      --accent: #6ea8ff;
      --accent-2: #7b6cff;
      --btn: #2a2f45;
      --btn-hover: #343a55;
      --shadow: 0 10px 30px rgba(0,0,0,0.25);
      --radius: 18px;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: sans-serif;
      background: var(--bg);
      color: var(--text);
      overflow-x: hidden;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 16px;
      background: var(--card);
      box-shadow: var(--shadow);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    header img.logo { height: 32px; }
    header .balance {
      display: flex;
      align-items: center;
      gap: 6px;
      font-weight: 600;
    }
    header .balance img { width: 18px; height: 18px; }
    main { padding: 16px; }
    .filters {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 16px;
      justify-content: center;
    }
    .filters input,
    .filters select {
      padding: 8px 12px;
      border-radius: 10px;
      border: none;
      outline: none;
      background: #1e2235;
      color: var(--text);
      font-size: 14px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 16px;
    }
    .card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 14px;
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
      gap: 10px;
      text-align: center;
      align-items: center;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .card:hover {
      transform: scale(1.03);
      box-shadow: 0 15px 35px rgba(0,0,0,0.35);
    }
    .card img.preview {
      width: 100%;
      border-radius: 12px;
      object-fit: cover;
      height: 150px;
    }
    .name { font-size: 15px; font-weight: 600; }
    .price {
      display: flex;
      align-items: center;
      gap: 4px;
      font-weight: 700;
    }
    .price img { width: 16px; height: 16px; }
    .btn {
      padding: 10px 12px;
      border-radius: 12px;
      background: linear-gradient(135deg,var(--accent),var(--accent-2));
      color: white;
      border: none;
      font-weight: 700;
      cursor: pointer;
      box-shadow: var(--shadow);
      transition: 0.2s;
    }
    .btn:hover { opacity: 0.9; }
    .tabs {
      position: fixed;
      bottom: 0; left: 0; right: 0;
      display: flex;
      justify-content: space-around;
      background: var(--card);
      padding: 10px 0;
      box-shadow: var(--shadow);
      z-index: 100;
    }
    .tabs button {
      background: none;
      border: none;
      color: var(--text);
      font-size: 14px;
      cursor: pointer;
      flex: 1;
    }
    .hidden { display: none; }
    .toast {
      position: fixed;
      bottom: 80px;
      right: 20px;
      background: var(--card);
      color: var(--text);
      padding: 10px 14px;
      border-radius: 10px;
      box-shadow: var(--shadow);
      display: none;
      z-index: 300;
    }
    .my-products { margin-top: 20px; }
    .my-products h3 { margin-bottom: 10px; }
  </style>
</head>
<body>
  <header>
    <img src="tonfiles.svg" class="logo" alt="logo">
    <div class="balance"><span id="balance">1000</span><img src="ton1.svg" alt="TON"></div>
  </header>

  <main id="homeTab">
    <div class="filters">
      <input type="text" id="search" placeholder="Поиск...">
      <select id="sort">
        <option value="new">Сначала новые</option>
        <option value="cheap">Сначала дешёвые</option>
        <option value="expensive">Сначала дорогие</option>
      </select>
    </div>
    <div class="grid" id="productGrid"></div>
  </main>

  <main id="profileTab" class="hidden">
    <h2>История покупок</h2>
    <div class="grid" id="historyGrid"></div>
    <div class="my-products">
      <h3>Мои товары</h3>
      <div class="grid" id="myProductsGrid"></div>
    </div>
  </main>

  <main id="addTab" class="hidden">
    <h2>Добавить товар</h2>
    <form id="addForm">
      <input type="text" id="prodName" placeholder="Название" required>
      <input type="number" id="prodPrice" placeholder="Цена в TON" required>
      <input type="file" id="prodImg" accept="image/*" required>
      <p>Вы получите: <span id="netAmount">0</span> TON</p>
      <button type="submit" class="btn">Опубликовать</button>
    </form>
  </main>

  <div class="tabs">
    <button onclick="showTab('homeTab')">Главная</button>
    <button onclick="showTab('addTab')">Добавить</button>
    <button onclick="showTab('profileTab')">Профиль</button>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    let balance = 1000;
    let products = [];
    let history = [];
    let myProducts = [];

    function showTab(tabId) {
      document.querySelectorAll("main").forEach(m=>m.classList.add("hidden"));
      document.getElementById(tabId).classList.remove("hidden");
      if(tabId==="profileTab"){ renderHistory(); renderMyProducts(); }
      if(tabId==="homeTab"){ renderProducts(); }
    }

    function renderProducts() {
      const grid = document.getElementById("productGrid");
      const search = document.getElementById("search").value.toLowerCase();
      let filtered = products.filter(p=>p.name.toLowerCase().includes(search));
      const sort = document.getElementById("sort").value;
      if(sort==="cheap") filtered.sort((a,b)=>a.price-b.price);
      if(sort==="expensive") filtered.sort((a,b)=>b.price-a.price);
      if(sort==="new") filtered.sort((a,b)=>b.id-a.id);
      grid.innerHTML = filtered.map(p=>`
        <div class="card">
          <img src="${p.img}" class="preview" alt="">
          <div class="name">${p.name}</div>
          <div class="price">${p.price} <img src="ton1.svg" alt="TON"></div>
          <button class="btn" onclick="buyProduct(${p.id})">Купить</button>
        </div>
      `).join("");
    }

    function buyProduct(id){
      const p=products.find(x=>x.id===id);
      if(balance<p.price){showToast("Недостаточно средств");return;}
      balance-=p.price;
      history.push(p);
      document.getElementById("balance").innerText=balance;
      renderHistory();
      showToast("Покупка успешна!");
    }

    function renderHistory(){
      const grid=document.getElementById("historyGrid");
      grid.innerHTML=history.map(p=>`
        <div class="card">
          <img src="${p.img}" class="preview" alt="">
          <div class="name">${p.name}</div>
          <div class="price">${p.price} <img src="ton1.svg" alt="TON"></div>
        </div>
      `).join("");
    }

    function renderMyProducts(){
      const grid=document.getElementById("myProductsGrid");
      grid.innerHTML=myProducts.map(p=>`
        <div class="card">
          <img src="${p.img}" class="preview" alt="">
          <div class="name">${p.name}</div>
          <div class="price">${p.price} <img src="ton1.svg" alt="TON"></div>
          <button class="btn" onclick="changePrice(${p.id})">Изменить цену</button>
          <button class="btn" onclick="removeProduct(${p.id})">Удалить</button>
        </div>
      `).join("");
    }

    function changePrice(id){
      const newPrice=prompt("Введите новую цену:");
      if(!newPrice) return;
      const p=myProducts.find(x=>x.id===id);
      p.price=parseInt(newPrice);
      const q=products.find(x=>x.id===id);
      if(q) q.price=p.price;
      renderMyProducts(); renderProducts();
      showToast("Цена изменена");
    }

    function removeProduct(id){
      myProducts=myProducts.filter(x=>x.id!==id);
      products=products.filter(x=>x.id!==id);
      renderMyProducts(); renderProducts();
      showToast("Товар удалён");
    }

    document.getElementById("prodPrice").addEventListener("input",()=>{
      const val=document.getElementById("prodPrice").value;
      document.getElementById("netAmount").innerText=(val*0.9).toFixed(2);
    });

    document.getElementById("addForm").addEventListener("submit",e=>{
      e.preventDefault();
      const name=document.getElementById("prodName").value;
      const price=parseInt(document.getElementById("prodPrice").value);
      const file=document.getElementById("prodImg").files[0];
      const reader=new FileReader();
      reader.onload=()=>{
        const prod={id:Date.now(),name,price,img:reader.result};
        products.push(prod); myProducts.push(prod);
        renderProducts();
        showTab("homeTab");
        showToast("Товар опубликован");
      };
      reader.readAsDataURL(file);
    });

    function showToast(msg){
      const toast=document.getElementById("toast");
      toast.innerText=msg;
      toast.style.display="block";
      setTimeout(()=>toast.style.display="none",2000);
    }

    document.getElementById("search").addEventListener("input",renderProducts);
    document.getElementById("sort").addEventListener("change",renderProducts);

    renderProducts();
  </script>
</body>
</html>