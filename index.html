<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TONFiles</title>
<style>
body {
  font-family: 'Segoe UI', sans-serif;
  margin: 0;
  background: #0f0f0f;
  color: white;
  overflow-x: hidden;
}
header {
  background: #141414;
  color: #36ff12;
  padding: 10px 20px;
  font-size: 20px;
  font-weight: bold;
  text-align: center;
  border-bottom: 2px solid #36ff12;
}
nav {
  display: flex;
  justify-content: space-around;
  background: #1a1a1a;
  border-bottom: 1px solid #36ff12;
}
nav button {
  flex: 1;
  background: none;
  border: none;
  color: #36ff12;
  padding: 12px;
  font-size: 16px;
  cursor: pointer;
  transition: 0.2s;
}
nav button.active {
  background: #36ff12;
  color: #000;
  font-weight: bold;
}
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 15px;
  padding: 15px;
}
.card {
  background: #1c1c1c;
  border-radius: 10px;
  overflow: hidden;
  transition: 0.2s;
  border: 1px solid #2a2a2a;
}
.card:hover { transform: scale(1.02); border-color: #36ff12; }
.image-wrap img { width: 100%; height: 150px; object-fit: cover; }
.card-body { padding: 10px; }
.title { font-weight: bold; font-size: 16px; margin-bottom: 5px; }
.desc { font-size: 13px; color: #bbb; }
.row-info {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 8px;
}
button.buy, button.own, button.bought {
  width: 100%;
  border: none;
  border-radius: 8px;
  padding: 10px;
  color: #000;
  font-weight: bold;
  cursor: pointer;
  margin-top: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
}
button.buy { background: #36ff12; }
button.own, button.bought { background: #111; color: #36ff12; border: 1px solid #36ff12; }
.ton-icon { height: 1em; vertical-align: middle; margin-left: 3px; }

/* Modal */
#modal, #profile-sheet {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.6);
  display: none;
  align-items: flex-end;
  justify-content: center;
  z-index: 100;
}
#modal.show, #profile-sheet.show { display: flex; }
.modal-card, .profile-card {
  background: #1a1a1a;
  border-radius: 20px 20px 0 0;
  padding: 20px;
  width: 100%;
  max-height: 90%;
  overflow-y: auto;
  animation: slideUp 0.3s ease;
  position: relative;
}
@keyframes slideUp {
  from { transform: translateY(100%); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}
.close {
  position: absolute;
  top: 10px;
  right: 20px;
  cursor: pointer;
  color: #36ff12;
  font-size: 20px;
}
.profile-handle {
  width: 40px;
  height: 5px;
  background: #555;
  border-radius: 5px;
  margin: 0 auto 15px auto;
  cursor: pointer;
}
.profile-header {
  display: flex;
  align-items: center;
  gap: 15px;
}
.profile-avatar {
  width: 60px; height: 60px; border-radius: 50%; object-fit: cover;
  border: 2px solid #36ff12;
}
.profile-info h3 { margin: 0; color: #36ff12; }

/* Toast */
#toast {
  position: fixed; bottom: 15px; left: 50%;
  transform: translateX(-50%);
  background: #36ff12; color: #000;
  padding: 10px 20px;
  border-radius: 20px;
  display: none;
  font-weight: bold;
}
#toast.show { display: block; animation: fade 3s forwards; }
@keyframes fade {
  0%{opacity:1;} 90%{opacity:1;} 100%{opacity:0;}
}
</style>
</head>
<body>

<header>TONFiles</header>
<nav>
  <button class="active" onclick="switchTab('market')">Маркет</button>
  <button onclick="switchTab('add')">Добавить</button>
  <button onclick="switchTab('profile')">Профиль</button>
</nav>

<!-- Контент -->
<div id="market" class="tab">
  <div class="grid" id="market-grid"></div>
</div>

<div id="add" class="tab" style="display:none; padding:20px;">
  <h3>Добавить товар</h3>
  <label>Название</label>
  <input id="add-title" class="input" type="text" placeholder="Введите название" style="width:100%; margin-bottom:10px;">
  <label>Описание</label>
  <textarea id="add-desc" class="input" placeholder="Описание товара" style="width:100%; margin-bottom:10px;"></textarea>
  <label>Цена (TON)</label>
  <input id="add-price" type="number" min="0" step="0.01" style="width:100%; margin-bottom:10px;">
  <div id="price-warning" style="font-size:12px; color:#888;">Минимальная цена 0.1 TON</div>
  <label>Фото</label>
  <input id="add-img" type="file" accept="image/*" style="width:100%; margin-bottom:10px;">
  <button onclick="addItem()" style="background:#36ff12; width:100%; padding:10px; border:none; border-radius:8px; font-weight:bold;">Опубликовать</button>
</div>

<div id="profile" class="tab" style="display:none; padding:20px;">
  <div id="profile-content"></div>
</div>

<!-- Окно товара -->
<div id="modal">
  <div class="modal-card" id="modal-card"></div>
</div>

<!-- Всплывающее окно профиля -->
<div id="profile-sheet">
  <div class="profile-card" id="profile-card">
    <div class="profile-handle" onclick="closeProfileSheet()"></div>
    <div id="profile-info"></div>
  </div>
</div>

<div id="toast"></div>

<script>
let items = [
  {id:1, title:"NFT Art", desc:"Уникальное цифровое искусство", price:2.5, rating:5.0, votes:3, img:"https://picsum.photos/300?1", seller:"user123"},
  {id:2, title:"TON Wallet", desc:"Безопасный кошелёк", price:1.2, rating:4.7, votes:6, img:"https://picsum.photos/300?2", seller:"user456"}
];
let user = {name:"Вы", username:"@you", rating:4.8, votes:10, trades:50, joined:"2023", avatar:"https://picsum.photos/100", visibility:{username:true,rating:true,trades:true,joined:true}};
let myPurchases = [];
let currentTab="market";

/* Переключение вкладок */
function switchTab(tab){
  document.querySelectorAll(".tab").forEach(el=>el.style.display="none");
  document.querySelectorAll("nav button").forEach(el=>el.classList.remove("active"));
  document.getElementById(tab).style.display="block";
  event.target.classList.add("active");
  if(tab==="market") renderMarket();
  if(tab==="profile") renderProfile();
}

/* Рендеринг */
function renderMarket(){
  const grid=document.getElementById("market-grid");
  grid.innerHTML=items.map(i=>`
  <div class="card" onclick="openModal(${i.id})">
    <div class="image-wrap"><img src="${i.img}"></div>
    <div class="card-body">
      <p class="title">${i.title}</p>
      <p class="desc">${i.desc}</p>
      <div class="row-info"><span>★ ${i.rating.toFixed(1)} (${i.votes})</span><span>${i.price}<img class="ton-icon" src="ton1.svg"></span></div>
      <button class="buy" onclick="event.stopPropagation();buyItem(${i.id})">Купить ${i.price}<img class="ton-icon" src="ton1.svg"></button>
    </div>
  </div>`).join('');
}

function renderProfile(){
  document.getElementById("profile-content").innerHTML=`
    <div style="display:flex; align-items:center; gap:15px;">
      <img src="${user.avatar}" class="profile-avatar">
      <div><h3>${user.name}</h3>
      <div style="color:#aaa;">${user.username}</div>
      <div>★ ${user.rating} (${user.votes})</div></div>
    </div>
    <h4 style="margin-top:15px;">Ваши товары</h4>
    <div class="grid">${items.filter(i=>i.seller==="self").map(i=>`
      <div class="card" onclick="openModal(${i.id})">
        <div class="image-wrap"><img src="${i.img}"></div>
        <div class="card-body">
          <p class="title">${i.title}</p>
          <p class="desc">${i.desc}</p>
          <div class="row-info"><span>★ ${i.rating.toFixed(1)} (${i.votes})</span><span>${i.price}<img class="ton-icon" src="ton1.svg"></span></div>
          <button class="own">Мой товар</button>
        </div>
      </div>`).join('')}</div>`;
}

/* Добавление товара */
function addItem(){
  const t=document.getElementById("add-title").value.trim();
  const d=document.getElementById("add-desc").value.trim();
  const p=parseFloat(document.getElementById("add-price").value);
  const img=document.getElementById("add-img").files[0];
  const warn=document.getElementById("price-warning");
  if(p<0.1){warn.style.color="red";document.getElementById("add-price").style.borderColor="red";return;}
  if(!t||!d||!p||!img)return toast("Заполните все поля");
  const r=new FileReader();
  r.onload=()=>{
    const id=Date.now();
    items.push({id,title:t,desc:d,price:p,rating:5.0,votes:0,img:r.result,seller:"self"});
    toast("Товар добавлен");
    document.getElementById("add-title").value="";
    document.getElementById("add-desc").value="";
    document.getElementById("add-price").value="";
    document.getElementById("add-img").value="";
    warn.style.color="#888";
    document.getElementById("add-price").style.borderColor="#36ff12";
  };
  r.readAsDataURL(img);
}

/* Покупка */
function buyItem(id){
  const item=items.find(i=>i.id===id);
  myPurchases.push(id);
  toast("Товар куплен!");
  openModal(id);
}

/* Окно товара */
function openModal(id){
  const i=items.find(it=>it.id===id);
  const owned=myPurchases.includes(id);
  document.getElementById("modal-card").innerHTML=`
    <div class="close" onclick="closeModal()">✕</div>
    <img src="${i.img}" style="width:100%;border-radius:10px;">
    <h3>${i.title}</h3>
    <div style="color:#aaa;">★ ${i.rating.toFixed(1)} (${i.votes}) • ${i.price} <img class="ton-icon" src="ton1.svg"></div>
    <p>${i.desc}</p>
    <button class="${owned?'bought':'buy'}" onclick="${owned?'':'buyItem('+i.id+')'}">${owned?'Приобретено':'Купить '+i.price+' '}<img class='ton-icon' src="ton1.svg"></button>
    <div style="margin-top:15px;cursor:pointer;color:#36ff12;" onclick="openProfileSheet('${i.seller}')">Посмотреть профиль продавца</div>
  `;
  document.getElementById("modal").classList.add("show");
}
function closeModal(){document.getElementById("modal").classList.remove("show");}

/* Всплывающий профиль */
function openProfileSheet(seller){
  const u = seller==="self"?user:{name:"User "+seller,username:"@"+seller,rating:4.8,votes:10,trades:30,joined:"2024",avatar:"https://picsum.photos/100"};
  document.getElementById("profile-info").innerHTML=`
    <div class="profile-header">
      <img src="${u.avatar}" class="profile-avatar">
      <div class="profile-info">
        <h3>${u.name}</h3>
        <div>${u.username}</div>
        <div>★ ${u.rating.toFixed(1)} (${u.votes})</div>
      </div>
    </div>
    <h4 style="margin-top:10px;">Товары продавца</h4>
    <div class="grid">${items.filter(i=>i.seller===seller).map(i=>`
      <div class="card" onclick="openModal(${i.id})">
        <div class="image-wrap"><img src="${i.img}"></div>
        <div class="card-body">
          <p class="title">${i.title}</p>
          <p class="desc">${i.desc}</p>
          <div class="row-info"><span>★ ${i.rating.toFixed(1)} (${i.votes})</span><span>${i.price}<img class="ton-icon" src="ton1.svg"></span></div>
          <button class="buy" onclick="event.stopPropagation();buyItem(${i.id})">Купить ${i.price}<img class="ton-icon" src="ton1.svg"></button>
        </div>
      </div>`).join('')}</div>
  `;
  document.getElementById("profile-sheet").classList.add("show");
}
function closeProfileSheet(){
  const sheet=document.getElementById("profile-sheet");
  sheet.classList.remove("show");
}

/* Toast */
function toast(msg){
  const t=document.getElementById("toast");
  t.textContent=msg;
  t.classList.add("show");
  setTimeout(()=>t.classList.remove("show"),2500);
}

renderMarket();
</script>
</body>
</html>
