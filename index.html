<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å</title>
<style>
:root {
  --bg:#0d111c; --card:#171c2c; --text:#e6eaff;
  --muted:#9aa3c7; --accent:#3b82f6; --accent-2:#6366f1;
  --btn:#2a2f45; --btn-hover:#343a55;
  --shadow:0 10px 30px rgba(0,0,0,0.3); --radius:18px;
}
*{box-sizing:border-box;}
body{margin:0;font-family:sans-serif;background:var(--bg);color:var(--text);}
main{padding:16px;min-height:calc(100vh - 60px);}
h2{margin:0 0 12px;}

input,textarea,button{
  font:inherit;padding:12px;border-radius:14px;border:none;
}
input,textarea{background:#1e2438;color:var(--text);width:100%;}
button{
  cursor:pointer;
  background:linear-gradient(135deg,var(--accent),var(--accent-2));
  color:white;font-weight:600;box-shadow:var(--shadow);
}
button:hover{opacity:0.9;}

.grid{display:grid;gap:16px;}
@media(min-width:600px){.grid{grid-template-columns:repeat(2,1fr);}}
@media(min-width:900px){.grid{grid-template-columns:repeat(3,1fr);}}

.card{
  background:var(--card);border-radius:var(--radius);padding:14px;
  box-shadow:var(--shadow);display:flex;flex-direction:column;gap:10px;
  transition:transform .2s;position:relative;overflow:hidden;
}
.card:hover{transform:scale(1.03);}
.card img{max-width:100%;border-radius:var(--radius);}
.price{font-weight:700;color:var(--accent);}
.review{background:#1e2438;padding:6px 8px;border-radius:8px;font-size:13px;margin:4px 0;}

.fav-btn{
  position:absolute;top:12px;right:12px;background:#1e2438;
  border:none;font-size:18px;cursor:pointer;color:var(--accent);
  border-radius:50%;width:32px;height:32px;display:flex;align-items:center;justify-content:center;
}
.fav-btn.active{color:#ffcc00;}

.bottom-nav{
  position:fixed;bottom:0;left:0;right:0;height:60px;
  background:var(--card);display:flex;justify-content:space-around;align-items:center;
  border-top:1px solid #2a2f45;z-index:99;
}
.bottom-nav button{
  flex:1;height:100%;border-radius:0;background:none;
  color:var(--text);font-size:14px;font-weight:600;transition:background .2s;
}
.bottom-nav button.active{background:var(--btn-hover);}

.hidden{display:none;}
.cart-item{background:var(--card);padding:12px;border-radius:14px;margin-bottom:10px;}
</style>
</head>
<body>

<main>
  <!-- –ì–ª–∞–≤–Ω–∞—è -->
  <section id="market">
    <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px;">
      <input type="text" id="searchInput" placeholder="üîç –ü–æ–∏—Å–∫..." style="flex:1;min-width:120px;">
    </div>
    <div class="grid" id="productsGrid"></div>
    <button id="loadMoreBtn" style="margin-top:12px;width:100%;">–ó–∞–≥—Ä—É–∑–∏—Ç—å –µ—â—ë</button>
  </section>

  <!-- –ö–æ—Ä–∑–∏–Ω–∞ -->
  <section id="cart" class="hidden">
    <h2>–ö–æ—Ä–∑–∏–Ω–∞</h2>
    <div id="cartItems"></div>
    <button onclick="checkout()">–û–ø–ª–∞—Ç–∏—Ç—å</button>
  </section>

  <!-- –î–æ–±–∞–≤–∏—Ç—å -->
  <section id="add" class="hidden">
    <h2>–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h2>
    <form id="addForm" style="display:flex;flex-direction:column;gap:12px;">
      <input type="text" id="addTitle" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" required>
      <textarea id="addDesc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" required></textarea>
      <input type="number" id="addPrice" placeholder="–¶–µ–Ω–∞ (TON)" required>
      <input type="file" id="addImage" accept="image/*">
      <button type="submit">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
    </form>
  </section>
</main>

<nav class="bottom-nav">
  <button onclick="showSection('market')" class="active">üè† –ì–ª–∞–≤–Ω–∞—è</button>
  <button onclick="showSection('cart')">üõí –ö–æ—Ä–∑–∏–Ω–∞ (<span id="cartCount">0</span>)</button>
  <button onclick="showSection('add')">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
</nav>

<script>
let products=JSON.parse(localStorage.getItem("products")||"[]");
let cart=JSON.parse(localStorage.getItem("cart")||"[]");
let favorites=JSON.parse(localStorage.getItem("favorites")||"[]");
let visibleCount=6;

function showSection(id){
  ["market","cart","add"].forEach(s=>document.getElementById(s).classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
  document.querySelectorAll(".bottom-nav button").forEach(b=>b.classList.remove("active"));
  document.querySelector(`.bottom-nav button[onclick="showSection('${id}')"]`).classList.add("active");
  if(id==="cart")renderCart();
}

function renderProducts(){
  const grid=document.getElementById("productsGrid");
  const query=document.getElementById("searchInput").value.toLowerCase();
  let filtered=products.filter(p=>
    p.title.toLowerCase().includes(query)||
    p.description.toLowerCase().includes(query)
  );

  grid.innerHTML=filtered.slice(0,visibleCount).map(p=>`
    <div class="card">
      <button class="fav-btn ${favorites.includes(p.id)?"active":""}" onclick="toggleFav(${p.id})">‚≠ê</button>
      ${p.image?`<img src="${p.image}" alt="${p.title}">`:""}
      <b>${p.title}</b>
      <div class="price">${p.price} TON</div>
      <div>${p.description}</div>
      <button onclick="addToCart(${p.id})">–í –∫–æ—Ä–∑–∏–Ω—É</button>
      <div>${p.reviews.map(r=>`<div class="review">‚≠ê${r.rating} ${r.text}</div>`).join("")}</div>
      <button onclick="addReview(${p.id})">–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</button>
    </div>
  `).join("");
  document.getElementById("loadMoreBtn").style.display=filtered.length>visibleCount?"block":"none";
}
document.getElementById("loadMoreBtn").onclick=()=>{visibleCount+=6;renderProducts();}
document.getElementById("searchInput").oninput=renderProducts;

function addToCart(id){
  const item=products.find(p=>p.id===id);
  cart.push(item);
  localStorage.setItem("cart",JSON.stringify(cart));
  updateCartCount();
}
function renderCart(){
  const c=document.getElementById("cartItems");
  c.innerHTML=cart.map((p,i)=>`<div class="cart-item">${p.title} - ${p.price} TON <button onclick="removeFromCart(${i})">–£–¥–∞–ª–∏—Ç—å</button></div>`).join("");
}
function removeFromCart(i){cart.splice(i,1);localStorage.setItem("cart",JSON.stringify(cart));renderCart();updateCartCount();}
function checkout(){alert("–§–µ–π–∫–æ–≤–∞—è –æ–ø–ª–∞—Ç–∞. –ü–æ—Å–ª–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ TON –∑–¥–µ—Å—å –±—É–¥–µ—Ç –Ω–∞—Å—Ç–æ—è—â–∞—è –æ–ø–ª–∞—Ç–∞.");cart=[];localStorage.setItem("cart","[]");renderCart();updateCartCount();}
function updateCartCount(){document.getElementById("cartCount").textContent=cart.length;}

function toggleFav(id){
  if(favorites.includes(id))favorites=favorites.filter(f=>f!==id);
  else favorites.push(id);
  localStorage.setItem("favorites",JSON.stringify(favorites));
  renderProducts();
}

function addReview(id){
  const text=prompt("–í–∞—à –æ—Ç–∑—ã–≤:");
  const rating=+prompt("–û—Ü–µ–Ω–∫–∞ –æ—Ç 1 –¥–æ 5:");
  if(text&&rating>=1&&rating<=5){
    const product=products.find(p=>p.id===id);
    product.reviews.push({text,rating});
    localStorage.setItem("products",JSON.stringify(products));
    renderProducts();
  }
}

document.getElementById("addForm").onsubmit=e=>{
  e.preventDefault();
  const file=document.getElementById("addImage").files[0];
  const reader=new FileReader();
  reader.onload=function(){
    const id=products.length?products[products.length-1].id+1:1;
    const item={
      id,
      title:document.getElementById("addTitle").value,
      description:document.getElementById("addDesc").value,
      price:+document.getElementById("addPrice").value,
      image:file?reader.result:"",
      reviews:[]
    };
    products.push(item);
    localStorage.setItem("products",JSON.stringify(products));
    renderProducts();
    showSection("market");
    e.target.reset();
  }
  if(file) reader.readAsDataURL(file); else reader.onload();
}

renderProducts();updateCartCount();
</script>
</body>
</html>
