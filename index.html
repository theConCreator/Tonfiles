<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tonfiles Market</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #000;
      color: #fff;
      overflow-x: hidden;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      background: #111;
      border-bottom: 2px solid #0eff00;
    }
    header img {
      height: 30px;
    }
    header .balance {
      display: flex;
      align-items: center;
      gap: 5px;
      font-weight: bold;
    }
    header .balance img {
      width: 12px;
      height: 12px;
      object-fit: contain;
    }
    main {
      padding: 15px;
    }
    .tabs {
      display: flex;
      justify-content: space-around;
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: #111;
      border-top: 2px solid #0eff00;
    }
    .tabs button {
      flex: 1;
      padding: 10px;
      background: none;
      border: none;
      color: #fff;
      font-size: 14px;
      cursor: pointer;
    }
    .tabs button.active {
      color: #0eff00;
      font-weight: bold;
    }
    .section {
      display: none;
    }
    .section.active {
      display: block;
    }
    /* Карточки */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 15px;
    }
    .card {
      background: #111;
      border: 1px solid #0eff00;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      height: 280px;
      overflow: hidden;
    }
    .card img {
      width: 100%;
      height: 160px;
      object-fit: cover;
      border-radius: 5px 5px 0 0;
    }
    .card-content {
      padding: 8px;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
    }
    .card-content h3 {
      font-size: 16px; /* название больше */
      margin: 4px 0;
      word-wrap: break-word;
      overflow: hidden;
      text-overflow: ellipsis;
      max-height: 38px;
      line-height: 1.2em;
    }
    .card-content p {
      font-size: 13px;
      margin: 2px 0; /* ближе к заголовку */
      word-wrap: break-word;
      overflow: hidden;
      text-overflow: ellipsis;
      max-height: 32px;
      line-height: 1.2em;
    }
    .card button {
      margin-top: auto;
      padding: 8px;
      width: 100%;
      background: #0eff00;
      color: #000;
      border: none;
      border-radius: 0 0 5px 5px;
      font-weight: bold;
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 5px;
    }
    .card button img {
      width: 12px;
      height: 12px;
      object-fit: contain;
    }
    /* Модальное окно */
    .modal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.8);
      display: none;
      justify-content: center;
      align-items: center;
    }
    .modal.active { display: flex; }
    .modal-content {
      background: #111;
      border: 1px solid #0eff00;
      border-radius: 10px;
      max-width: 400px;
      width: 90%;
      padding: 15px;
      text-align: center;
    }
    .modal-content img {
      width: 100%;
      max-height: 200px;
      object-fit: cover;
      border-radius: 5px;
      margin-bottom: 10px;
    }
    .modal-content button {
      margin-top: 10px;
      width: 100%;
      padding: 10px;
      border-radius: 5px;
      border: none;
      font-weight: bold;
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 5px;
    }
    .modal-content button img {
      width: 12px;
      height: 12px;
      object-fit: contain;
      vertical-align: middle; /* чтобы значок был ровно по центру */
    }
    .buy-btn { background: #0eff00; color: #000; }
    .owned-btn { background: #333; color: #0eff00; }
    .file-btn { background: #222; color: #fff; }
    /* Уведомления */
    .toast {
      position: fixed;
      bottom: 70px;
      right: 20px;
      background: #111;
      border: 1px solid #0eff00;
      padding: 10px 15px;
      border-radius: 5px;
      opacity: 0;
      transition: opacity 1s;
    }
    .toast.show {
      opacity: 1;
      transition: opacity 0.5s;
    }
    /* Профиль */
    .profile-tabs {
      display: flex;
      justify-content: center;
      margin-bottom: 10px;
      border-bottom: 1px solid #0eff00;
    }
    .profile-tabs button {
      flex: 1;
      padding: 8px;
      background: none;
      border: none;
      color: #fff;
      cursor: pointer;
    }
    .profile-tabs button.active {
      color: #0eff00;
      font-weight: bold;
    }
    .profile-section { display: none; }
    .profile-section.active { display: block; }
    .empty-text {
      text-align: center;
      color: #777;
      margin: 20px 0;
    }
    /* Публикация */
    #add {
      max-width: 400px;
      margin: 0 auto;
    }
    .form-group {
      margin: 10px 0;
    }
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-size: 14px;
    }
    .form-group input, .form-group textarea {
      width: 100%;
      padding: 8px;
      border: 1px solid #0eff00;
      border-radius: 5px;
      background: #111;
      color: #fff;
      box-sizing: border-box;
    }
    .form-group input[type="file"] {
      border: none;
    }
    button:focus, input:focus, textarea:focus {
      outline: none;
      box-shadow: 0 0 5px #0eff00;
    }
  </style>
</head>
<body>
  <header>
    <img src="tonfiles.svg" alt="logo">
    <div class="balance"><span id="balance">1000.00</span><img src="ton1.svg" alt="ton"></div>
  </header>

  <main>
    <!-- Главная -->
    <section id="home" class="section active">
      <div class="grid" id="market-grid"></div>
    </section>

    <!-- Добавить -->
    <section id="add" class="section">
      <h2>Публикация объявления</h2>
      <div class="form-group"><label>Название</label><input id="add-name"></div>
      <div class="form-group"><label>Описание</label><textarea id="add-desc"></textarea></div>
      <div class="form-group"><label>Цена</label><input id="add-price" type="number" step="0.01" oninput="updateNet()">
        <small id="net-text"></small>
      </div>
      <div class="form-group"><label>Загрузка файлов</label>
        <input id="add-preview" type="file" accept="image/*">
        <input id="add-file" type="file">
      </div>
      <button onclick="publish()">Опубликовать</button>
    </section>

    <!-- Профиль -->
    <section id="profile" class="section">
      <h2>Профиль</h2>
      <div style="margin-bottom:15px; padding:10px; border:1px solid #0eff00; border-radius:8px; background:#111;">
        <h3>Реферальная система</h3>
        <p>Баланс: <span id="ref-balance">0.00</span> <img src="ton1.svg" alt="ton" style="width:12px; height:12px; object-fit:contain"></p>
        <p style="color:#777; font-size:13px;">2% от трат рефералов</p>
        <button onclick="withdrawRef()">Вывести</button>
      </div>
      <div class="profile-tabs">
        <button class="active" onclick="switchProfileTab('purchases')">Мои покупки</button>
        <button onclick="switchProfileTab('myitems')">Мои товары</button>
      </div>
      <div id="purchases" class="profile-section active">
        <div id="purchases-grid" class="grid"></div>
        <div class="empty-text" id="purchases-empty">Ничего не найдено</div>
      </div>
      <div id="myitems" class="profile-section">
        <div id="myitems-grid" class="grid"></div>
        <div class="empty-text" id="myitems-empty">Ничего не найдено</div>
      </div>
    </section>
  </main>

  <div class="tabs">
    <button class="active" onclick="switchTab('home', this)">Главная</button>
    <button onclick="switchTab('add', this)">Добавить</button>
    <button onclick="switchTab('profile', this)">Профиль</button>
  </div>

  <!-- Модалка -->
  <div class="modal" id="modal">
    <div class="modal-content">
      <h3 id="modal-name"></h3>
      <img id="modal-img">
      <p id="modal-desc"></p>
      <div id="modal-actions"></div>
      <button onclick="closeModal()">Закрыть</button>
    </div>
  </div>

  <div class="toast" id="toast"></div>

<script>
  let balance = 1000.00, refBalance = 0.00;
  let items = [
    {id:1, name:"Тестовый товар", desc:"Описание тестового товара", price:25.50, img:"https://via.placeholder.com/300x200", file:"file.txt", owner:false, purchased:false}
  ];
  let myItems=[], purchases=[];

  function switchTab(id, btn){
    document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    document.querySelectorAll('.tabs button').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    render();
  }
  function switchProfileTab(tab){
    document.querySelectorAll('.profile-section').forEach(s=>s.classList.remove('active'));
    document.getElementById(tab).classList.add('active');
    document.querySelectorAll('.profile-tabs button').forEach(b=>b.classList.remove('active'));
    event.target.classList.add('active');
  }
  function updateNet(){
    let price=parseFloat(document.getElementById('add-price').value)||0;
    document.getElementById('net-text').innerText="Вы получите "+(price*0.9).toFixed(2)+" TON (с учётом комиссии 10%)";
  }
  function publish(){
    let name=document.getElementById('add-name').value;
    let desc=document.getElementById('add-desc').value;
    let price=parseFloat(document.getElementById('add-price').value)||0;
    let imgFile=document.getElementById('add-preview').files[0];
    let file=document.getElementById('add-file').files[0];
    if(!name||!desc||!price||!imgFile||!file){showToast("Заполните все поля");return;}
    let reader=new FileReader();
    reader.onload=e=>{
      let newItem={id:Date.now(), name, desc, price, img:e.target.result, file:file.name, owner:true, purchased:false};
      items.push(newItem); myItems.push(newItem);
      showToast("Товар опубликован");
      render();
    };
    reader.readAsDataURL(imgFile);
  }
  function openModal(item){
    document.getElementById('modal-name').innerText=item.name;
    document.getElementById('modal-img').src=item.img;
    document.getElementById('modal-desc').innerText=item.desc;
    let act=document.getElementById('modal-actions'); act.innerHTML="";
    if(item.owner){ act.innerHTML="<button class='owned-btn'>Мой товар</button>";}
    else if(item.purchased){
      act.innerHTML="<button class='owned-btn'>Приобретено</button><button class='file-btn'>Получить файл</button>";
    } else {
      act.innerHTML=`<button class='buy-btn' onclick='buy(${item.id})'>Купить ${item.price.toFixed(2)} <img src="ton1.svg" alt="ton"></button>`;
    }
    document.getElementById('modal').classList.add('active');
  }
  function closeModal(){document.getElementById('modal').classList.remove('active');}
  function buy(id){
    let item=items.find(i=>i.id===id);
    if(balance<item.price){showToast("Недостаточно средств");return;}
    balance-=item.price; refBalance+=item.price*0.02;
    item.purchased=true; purchases.push(item);
    showToast("Покупка успешна"); render(); closeModal();
  }
  function withdrawRef(){if(refBalance<=0){showToast("Нет средств");return;} balance+=refBalance; refBalance=0; showToast("Вывод успешен"); render();}
  function showToast(msg){
    let t=document.getElementById('toast');t.innerText=msg;t.classList.add('show');
    setTimeout(()=>{t.classList.remove('show');},2500);
  }
  function render(){
    document.getElementById('balance').innerText=balance.toFixed(2);
    document.getElementById('ref-balance').innerText=refBalance.toFixed(2);
    let market=document.getElementById('market-grid');market.innerHTML="";
    items.forEach(it=>{
      let card=document.createElement('div');card.className="card";
      card.innerHTML=`<img src="${it.img}">
        <div class="card-content"><h3>${cut(it.name,35)}</h3><p>${cut(it.desc,35)}</p></div>`;
      let btn=document.createElement('button');
      if(it.owner)btn.innerText="Мой товар";
      else if(it.purchased)btn.innerText="Приобретено";
      else btn.innerHTML=`Купить ${it.price.toFixed(2)} <img src="ton1.svg" alt="ton">`;
      btn.onclick=()=>openModal(it); card.appendChild(btn);
      market.appendChild(card);
    });
    let pur=document.getElementById('purchases-grid');pur.innerHTML="";
    purchases.forEach(it=>{
      let c=document.createElement('div');c.className="card";
      c.innerHTML=`<img src="${it.img}">
        <div class="card-content"><h3>${cut(it.name,35)}</h3><p>${cut(it.desc,35)}</p></div>`;
      let b=document.createElement('button');b.innerText="Приобретено";b.onclick=()=>openModal(it);c.appendChild(b);pur.appendChild(c);
    });
    document.getElementById('purchases-empty').style.display=purchases.length?"none":"block";
    let my=document.getElementById('myitems-grid');my.innerHTML="";
    myItems.forEach(it=>{
      let c=document.createElement('div');c.className="card";
      c.innerHTML=`<img src="${it.img}">
        <div class="card-content"><h3>${cut(it.name,35)}</h3><p>${cut(it.desc,35)}</p></div>`;
      let b=document.createElement('button');b.innerText="Мой товар";c.appendChild(b);my.appendChild(c);
    });
    document.getElementById('myitems-empty').style.display=myItems.length?"none":"block";
  }
  function cut(text,len){if(text.length<=len)return text;return text.slice(0,len)+"...";}
  render();
</script>
</body>
</html>
