<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TonFiles Market</title>
<style>
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
body{margin:0;font-family:"Inter",Arial,sans-serif;background:#000;color:#fff;overflow-x:hidden;}
header{display:flex;justify-content:space-between;align-items:center;background:#0a0a0a;padding:10px 18px;border-bottom:2px solid #0eff00;position:sticky;top:0;z-index:100;}
header img{height:26px;}
header .balance{display:flex;align-items:center;gap:6px;font-weight:bold;}
header .balance img{width:14px;height:14px;object-fit:contain;}

main{padding:15px 15px 70px;max-width:1200px;margin:auto;}
.tabs{display:flex;justify-content:space-around;align-items:center;position:fixed;bottom:0;left:0;width:100%;background:#0a0a0a;border-top:2px solid #0eff00;z-index:200;}
.tabs button{flex:1;background:none;border:none;color:#888;padding:10px;cursor:pointer;font-weight:bold;font-size:14px;}
.tabs button.active{color:#0eff00;}
.section{display:none;}
.section.active{display:block;}

.search-filter{display:flex;flex-wrap:wrap;gap:10px;margin-bottom:15px;}
.search-filter input{flex:1;min-width:130px;padding:8px;border:1px solid #0eff00;border-radius:6px;background:#0a0a0a;color:#fff;}
.custom-select{position:relative;min-width:160px;flex:1;}
.custom-select button{width:100%;background:#0a0a0a;border:1px solid #0eff00;color:#fff;text-align:left;padding:8px;border-radius:6px;}
.custom-select button:after{content:"▼";float:right;color:#0eff00;}
.custom-options{display:none;position:absolute;top:38px;left:0;width:100%;background:#0a0a0a;border:1px solid #0eff00;border-radius:6px;z-index:20;}
.custom-options div{padding:8px;cursor:pointer;}
.custom-options div:hover{background:#0eff00;color:#000;}
.custom-select.open .custom-options{display:block;}

.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:15px;}
.card{background:#0a0a0a;border:1px solid #0eff00;border-radius:10px;display:flex;flex-direction:column;justify-content:space-between;box-shadow:0 0 8px rgba(14,255,0,0.1);overflow:hidden;transition:all .2s;cursor:pointer;}
.card:hover{transform:translateY(-2px);box-shadow:0 0 12px rgba(14,255,0,0.2);}
.image-wrapper{width:100%;height:160px;background:#111;overflow:hidden;display:flex;align-items:center;justify-content:center;}
.image-wrapper img{width:100%;height:100%;object-fit:cover;display:block;}
.card-content{padding:10px;flex-grow:1;display:flex;flex-direction:column;justify-content:space-between;position:relative;}
.card-content h3{font-size:16px;margin:2px 0 3px;}
.card-content p{font-size:13px;color:#aaa;margin:3px 0 8px;}
.card .item-id{position:absolute;top:6px;right:8px;font-size:11px;color:#666;}

.info-line{display:flex;justify-content:space-between;align-items:center;font-size:13px;color:#aaa;margin-top:auto;margin-bottom:5px;}
.card .btn-row{display:flex;gap:6px;margin-top:5px;}
.card button{background:#0eff00;color:#000;font-weight:bold;border:none;border-radius:6px;padding:7px;flex:1;display:flex;align-items:center;justify-content:center;gap:5px;cursor:pointer;}
.card button img{width:12px;height:12px;object-fit:contain;}
.card button:hover{opacity:0.9;}

.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);display:none;justify-content:center;align-items:center;z-index:1000;}
.modal.active{display:flex;}
.modal-content{background:#0a0a0a;border:1px solid #0eff00;border-radius:10px;padding:15px;max-width:420px;width:90%;text-align:center;box-shadow:0 0 20px rgba(14,255,0,0.15);}
.modal-content img{width:100%;max-height:200px;object-fit:cover;border-radius:6px;margin-bottom:10px;}
.modal-content button{margin-top:6px;width:100%;border-radius:6px;padding:8px;}
.modal-content img.icon{width:12px;height:12px;vertical-align:middle;margin-left:4px;}

#add{max-width:440px;margin:0 auto;}
#add h2{text-align:center;}
#add .form-group{margin-bottom:12px;}
#add label{display:block;margin-bottom:4px;color:#0eff00;font-size:13px;}
#add input,#add textarea{background:#0a0a0a;border:1px solid #0eff00;color:#fff;border-radius:6px;padding:8px;width:100%;font-size:14px;}
#add button{background:#0eff00;color:#000;width:100%;padding:10px;border-radius:6px;font-weight:bold;}

#profile h2{text-align:center;margin-top:0;}
.profile-box{padding:10px;background:#0a0a0a;border:1px solid #0eff00;border-radius:8px;margin-bottom:15px;box-shadow:0 0 10px rgba(14,255,0,0.1);}
.profile-tabs{display:flex;justify-content:center;border-bottom:1px solid #0eff00;margin-bottom:10px;}
.profile-tabs button{flex:1;background:none;border:none;color:#fff;padding:8px;font-weight:600;}
.profile-tabs button.active{color:#0eff00;}
.profile-search{margin-bottom:10px;}
.profile-search input{width:100%;background:#0a0a0a;border:1px solid #0eff00;border-radius:6px;padding:8px;color:#fff;}

.toast{position:fixed;bottom:70px;right:20px;background:#0a0a0a;border:1px solid #0eff00;padding:10px 15px;border-radius:6px;opacity:0;transition:opacity 0.4s;z-index:1000;}
.toast.show{opacity:1;}
</style>
</head>
<body>
<header>
  <img src="tonfiles.svg" alt="logo">
  <div class="balance"><span id="balance">1000.00</span><img src="ton1.svg" alt="ton"></div>
</header>

<main>
  <section id="home" class="section active">
    <div class="search-filter">
      <input id="search-input" placeholder="Поиск...">
      <div style="display:flex;gap:10px;width:100%;">
        <input id="min-price" type="number" placeholder="Мин. цена">
        <input id="max-price" type="number" placeholder="Макс. цена">
      </div>
      <div class="custom-select" id="sort-select">
        <button id="sort-btn">Последние</button>
        <div class="custom-options">
          <div data-val="newest">Последние</div>
          <div data-val="price_asc">Цена ↑</div>
          <div data-val="price_desc">Цена ↓</div>
          <div data-val="best">Отзывы: лучшие</div>
          <div data-val="count">Отзывы: количество</div>
        </div>
      </div>
      <button onclick="render()">Применить</button>
    </div>
    <div class="grid" id="market-grid"></div>
  </section>

  <section id="add" class="section">
    <h2>Публикация объявления</h2>
    <div class="form-group"><label>Название</label><input id="add-name"></div>
    <div class="form-group"><label>Описание</label><textarea id="add-desc"></textarea></div>
    <div class="form-group"><label>Цена (TON)</label><input id="add-price" type="number" step="0.01"></div>
    <div class="form-group"><label>Изображение</label><input id="add-preview" type="file" accept="image/*"></div>
    <div class="form-group"><label>Файл</label><input id="add-file" type="file"></div>
    <button onclick="publish()">Опубликовать</button>
  </section>

  <section id="profile" class="section">
    <h2>Профиль</h2>
    <div class="profile-box">
      <h3>Реферальная система</h3>
      <p>Баланс: <span id="ref-balance">0.00</span> <img src="ton1.svg" style="width:12px;height:12px;vertical-align:middle"></p>
      <p style="color:#777;font-size:13px;">2% от трат рефералов</p>
      <button onclick="withdrawRef()">Вывести</button>
    </div>

    <div class="profile-tabs">
      <button class="active" onclick="switchProfileTab('purchases', this)">Мои покупки</button>
      <button onclick="switchProfileTab('myitems', this)">Мои товары</button>
    </div>

    <div class="profile-search">
      <input id="profile-search" placeholder="Поиск покупок..." oninput="render()">
    </div>

    <div id="purchases" class="profile-section active">
      <div id="purchases-grid" class="grid"></div>
      <p id="purchases-empty" style="text-align:center;color:#777;">Пусто</p>
    </div>

    <div id="myitems" class="profile-section">
      <div id="myitems-grid" class="grid"></div>
      <p id="myitems-empty" style="text-align:center;color:#777;">Пусто</p>
    </div>
  </section>
</main>

<div class="tabs">
  <button class="active" onclick="switchTab('home',this)">Главная</button>
  <button onclick="switchTab('add',this)">Добавить</button>
  <button onclick="switchTab('profile',this)">Профиль</button>
</div>

<div class="modal" id="item-modal">
  <div class="modal-content" id="modal-content"></div>
</div>

<div class="toast" id="toast"></div>

<script>
let balance=1000, refBalance=0, userId=1;
let purchases=[], myItems=[], currentProfileTab='purchases';
const tonIcon='<img src="ton1.svg" style="width:12px;height:12px;vertical-align:middle;">';
let items=[
{id:101,name:"Скрипт Telegram Bot",desc:"Полностью рабочий бот",price:15,img:"https://via.placeholder.com/300x200?text=Bot",file:"bot.zip",ownerId:2,reviews:[5,4]},
{id:102,name:"Видеоурок по дизайну",desc:"Советы для UI/UX",price:8,img:"https://via.placeholder.com/300x200?text=Design",file:"design.mp4",ownerId:3,reviews:[5,5,4]},
{id:103,name:"NFT шаблон",desc:"Шаблон NFT-коллекции",price:22,img:"https://via.placeholder.com/300x200?text=NFT",file:"nft.psd",ownerId:4,reviews:[4,3]},
{id:104,name:"React сайт",desc:"Красивый адаптивный шаблон",price:18,img:"https://via.placeholder.com/300x200?text=React",file:"site.zip",ownerId:5,reviews:[]},
{id:105,name:"Python API пример",desc:"REST API шаблон",price:12,img:"https://via.placeholder.com/300x200?text=API",file:"api.py",ownerId:6,reviews:[5]}
];

function switchTab(id,btn){
 document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
 document.getElementById(id).classList.add('active');
 document.querySelectorAll('.tabs button').forEach(b=>b.classList.remove('active'));
 btn.classList.add('active');
 render();
}
function switchProfileTab(id,btn){
 currentProfileTab=id;
 document.querySelectorAll('.profile-section').forEach(s=>s.classList.remove('active'));
 document.getElementById(id).classList.add('active');
 document.querySelectorAll('.profile-tabs button').forEach(b=>b.classList.remove('active'));
 btn.classList.add('active');
 document.getElementById('profile-search').placeholder=id==='purchases'?'Поиск покупок...':'Поиск товаров...';
 render();
}
function showToast(msg){
 const t=document.getElementById('toast');
 t.innerText=msg;t.classList.add('show');
 setTimeout(()=>t.classList.remove('show'),2500);
}
function withdrawRef(){
 if(refBalance>0){refBalance=0;showToast("Вывод средств выполнен");}
 else showToast("Недостаточно средств для вывода");
 render();
}
function publish(){
 let name=document.getElementById('add-name').value.trim();
 let desc=document.getElementById('add-desc').value.trim();
 let price=parseFloat(document.getElementById('add-price').value)||0;
 let imgFile=document.getElementById('add-preview').files[0];
 let file=document.getElementById('add-file').files[0];
 if(!name||!desc||!price||!imgFile||!file){showToast("Заполните все поля");return;}
 let reader=new FileReader();
 reader.onload=e=>{
   let id=Math.floor(Math.random()*999999)+1;
   let item={id,name,desc,price,img:e.target.result,file:file.name,ownerId:userId,reviews:[]};
   items.unshift(item);myItems.push(item);
   document.querySelectorAll('#add input,#add textarea').forEach(i=>i.value="");
   showToast("Товар опубликован");
   render();
 };
 reader.readAsDataURL(imgFile);
}
function calcAvg(a){return a.length?a.reduce((x,y)=>x+y)/a.length:0;}
function cardHTML(item){
 let owned=item.ownerId===userId;let bought=purchases.includes(item.id);
 let avg=calcAvg(item.reviews).toFixed(1);
 return `<div class='card' onclick="openModal(${item.id})">
  <div class='image-wrapper'><img src='${item.img}'></div>
  <div class='card-content'>
   <div class='item-id'>#${String(item.id).padStart(5,'0')}</div>
   <h3>${item.name}</h3>
   <p>${item.desc}</p>
   <div class='info-line'>⭐ ${avg} (${item.reviews.length}) • ${item.price.toFixed(2)} ${tonIcon}</div>
   <div class='btn-row'>
     ${owned?`<button>Мой товар</button>`:bought?`<button>Приобретено</button><button>Получить файл</button>`:`<button>Купить за ${item.price.toFixed(2)} ${tonIcon}</button>`}
   </div>
  </div>
 </div>`;
}
function openModal(id){
 const item=items.find(i=>i.id===id);
 const owned=item.ownerId===userId;
 const bought=purchases.includes(item.id);
 let avg=calcAvg(item.reviews).toFixed(1);
 const modal=document.getElementById('item-modal');
 const c=document.getElementById('modal-content');
 c.innerHTML=`<img src="${item.img}" alt="">
 <h3>${item.name}</h3>
 <p>${item.desc}</p>
 <p><strong>${item.price.toFixed(2)} ${tonIcon}</strong></p>
 <p>⭐ ${avg} (${item.reviews.length})</p>
 ${owned?'<button disabled>Мой товар</button>':bought?'<button disabled>Приобретено</button><button>Получить файл</button>': `<button onclick="buy(${item.id})">Купить за ${item.price.toFixed(2)} ${tonIcon}</button>`}
 <button onclick="closeModal()">Закрыть</button>`;
 modal.classList.add('active');
}
function closeModal(){document.getElementById('item-modal').classList.remove('active');}
function buy(id){
 let item=items.find(i=>i.id===id);
 if(balance<item.price){showToast("Недостаточно средств");return;}
 balance-=item.price;refBalance+=item.price*0.02;purchases.push(id);
 showToast("Покупка успешна");closeModal();render();
}
function render(){
 document.getElementById('balance').innerText=balance.toFixed(2);
 document.getElementById('ref-balance').innerText=refBalance.toFixed(2);

 let s=document.getElementById('search-input').value.toLowerCase();
 let min=parseFloat(document.getElementById('min-price').value)||0;
 let max=parseFloat(document.getElementById('max-price').value)||Infinity;
 let grid=document.getElementById('market-grid');
 grid.innerHTML=items.filter(i=>(i.name+i.desc).toLowerCase().includes(s)&&i.price>=min&&i.price<=max).map(cardHTML).join('');

 let q=document.getElementById('profile-search').value.toLowerCase();
 if(currentProfileTab==='purchases'){
   let p=items.filter(i=>purchases.includes(i.id)&&(i.name+i.desc).toLowerCase().includes(q));
   document.getElementById('purchases-grid').innerHTML=p.map(cardHTML).join('');
   document.getElementById('purchases-empty').style.display=p.length?'none':'block';
 } else {
   let m=myItems.filter(i=>(i.name+i.desc).toLowerCase().includes(q));
   document.getElementById('myitems-grid').innerHTML=m.map(cardHTML).join('');
   document.getElementById('myitems-empty').style.display=m.length?'none':'block';
 }
}

document.getElementById('sort-select').addEventListener('click',e=>{
 const el=document.getElementById('sort-select');
 if(e.target.dataset.val){sort=e.target.dataset.val;document.getElementById('sort-btn').innerText=e.target.innerText;el.classList.remove('open');render();}
 else el.classList.toggle('open');
});
render();
</script>
</body>
</html>
