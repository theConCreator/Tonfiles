<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TONFiles Market</title>
  <style>
    :root {
      --bg: #0f1220;
      --card: #171a2a;
      --text: #e8ebff;
      --muted: #9aa3c7;
      --accent: #6ea8ff;
      --accent-2: #7b6cff;
      --btn: #2a2f45;
      --btn-hover: #343a55;
      --radius: 14px;
      --shadow: 0 10px 25px rgba(0,0,0,0.35);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: sans-serif;
      background: var(--bg);
      color: var(--text);
      overflow-x: hidden;
    }
    header {
      padding: 14px;
      text-align: center;
      font-weight: 700;
      font-size: 18px;
      background: var(--card);
      box-shadow: var(--shadow);
      position: sticky;
      top: 0;
      z-index: 50;
    }
    .tabs {
      display: flex;
      justify-content: space-around;
      padding: 12px;
      background: var(--card);
      border-top: 1px solid #22263c;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
    }
    .tab {
      flex: 1;
      text-align: center;
      padding: 10px;
      cursor: pointer;
      font-size: 14px;
      color: var(--muted);
    }
    .tab.active {
      color: var(--accent);
      font-weight: 700;
    }
    main { padding: 16px; padding-bottom: 70px; }
    .filters {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-bottom: 16px;
    }
    .filters input {
      flex: 1 1 200px;
      padding: 10px;
      border-radius: var(--radius);
      border: none;
      background: #1e2235;
      color: var(--text);
    }
    .filters select, .filters button {
      padding: 10px 14px;
      border-radius: var(--radius);
      border: none;
      background: var(--btn);
      color: var(--text);
      cursor: pointer;
    }
    .filters button:hover { background: var(--btn-hover); }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill,minmax(180px,1fr));
      gap: 16px;
    }
    .card {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 14px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      text-align: center;
      position: relative;
    }
    .card img {
      max-width: 100%;
      border-radius: var(--radius);
      object-fit: cover;
    }
    .card .badge {
      position: absolute;
      top: 8px;
      left: 8px;
      background: var(--accent-2);
      color: white;
      font-size: 11px;
      padding: 3px 6px;
      border-radius: 8px;
    }
    .btn {
      background: linear-gradient(135deg,var(--accent),var(--accent-2));
      color: #fff;
      border: none;
      border-radius: var(--radius);
      padding: 8px 14px;
      font-weight: 600;
      cursor: pointer;
      margin-top: auto;
      width: 100%;
    }
    .btn:hover { opacity: 0.9; }
    .btn.green { background: #22c55e; }
    .profile {
      display: flex;
      flex-direction: column;
      gap: 14px;
    }
    .balance {
      background: var(--card);
      padding: 16px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }
    .history, .my-products {
      background: var(--card);
      padding: 16px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }
    .toast {
      position: fixed;
      bottom: 90px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--accent);
      color: #fff;
      padding: 12px 20px;
      border-radius: var(--radius);
      font-size: 14px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
      z-index: 1000;
    }
    .toast.show { opacity: 1; }
    .modal {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.6);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1001;
    }
    .modal.active { display: flex; }
    .modal-content {
      background: var(--card);
      padding: 20px;
      border-radius: var(--radius);
      width: 90%;
      max-width: 400px;
      text-align: center;
    }
    .modal-content input {
      width: 100%;
      margin: 12px 0;
      padding: 10px;
      border-radius: var(--radius);
      border: none;
      background: #1e2235;
      color: var(--text);
    }
  </style>
</head>
<body>
  <header>TONFiles Market</header>
  <main id="main"></main>
  <div class="tabs">
    <div class="tab active" data-tab="home">Главная</div>
    <div class="tab" data-tab="add">Добавить</div>
    <div class="tab" data-tab="profile">Профиль</div>
  </div>
  <div class="toast" id="toast"></div>
  <div class="modal" id="priceModal">
    <div class="modal-content">
      <h3>Изменить цену</h3>
      <input type="number" id="newPrice" placeholder="Новая цена">
      <button class="btn" onclick="confirmPriceChange()">Сохранить</button>
    </div>
  </div>
  <script>
    let balance = 1000;
    let products = [
      {id:1, title:"Гайд по TON", price:200, owner:false, bought:false, img:""},
      {id:2, title:"Скрипт автоторговли", price:500, owner:false, bought:false, img:""},
      {id:3, title:"Файл ресурсов", price:300, owner:false, bought:false, img:""}
    ];
    let purchases = [];
    let myProducts = [];
    let editProductId = null;

    const main = document.getElementById('main');
    const toast = document.getElementById('toast');
    const modal = document.getElementById('priceModal');
    const newPriceInput = document.getElementById('newPrice');

    function showToast(msg){
      toast.textContent = msg;
      toast.classList.add('show');
      setTimeout(()=>toast.classList.remove('show'),2000);
    }

    function switchTab(tab){
      document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
      document.querySelector(`.tab[data-tab="${tab}"]`).classList.add('active');
      if(tab==="home") renderHome();
      if(tab==="add") renderAdd();
      if(tab==="profile") renderProfile();
    }

    function renderHome(){
      main.innerHTML = `
        <div class="filters">
          <input type="text" id="search" placeholder="Поиск...">
          <select id="sort">
            <option value="default">По умолчанию</option>
            <option value="cheap">Сначала дешёвые</option>
            <option value="expensive">Сначала дорогие</option>
          </select>
          <select id="filter">
            <option value="all">Все товары</option>
            <option value="bought">Купленные</option>
          </select>
        </div>
        <div class="grid">
          ${products.map(p=>{
            const badge = p.owner ? '<div class="badge">Мой товар</div>' : '';
            let btn = `<button class="btn" onclick="buy(${p.id})">Купить за ${p.price} TON</button>`;
            if(p.bought) btn = `<button class="btn green">Куплено</button>`;
            return `
              <div class="card">
                ${badge}
                ${p.img?`<img src="${p.img}">`:"<div style='height:120px;width:100%;background:#1e2235;border-radius:var(--radius);'></div>"}
                <div>${p.title}</div>
                <div>${p.price} TON</div>
                ${btn}
              </div>
            `;
          }).join("")}
        </div>
      `;
      document.getElementById('search').addEventListener('input',renderHomeFiltered);
      document.getElementById('sort').addEventListener('change',renderHomeFiltered);
      document.getElementById('filter').addEventListener('change',renderHomeFiltered);
    }

    function renderHomeFiltered(){
      const q=document.getElementById('search').value.toLowerCase();
      const sort=document.getElementById('sort').value;
      const filter=document.getElementById('filter').value;
      let list=products.filter(p=>p.title.toLowerCase().includes(q));
      if(filter==="bought") list=list.filter(p=>p.bought);
      if(sort==="cheap") list.sort((a,b)=>a.price-b.price);
      if(sort==="expensive") list.sort((a,b)=>b.price-a.price);
      const grid=main.querySelector('.grid');
      grid.innerHTML=list.map(p=>{
        const badge = p.owner ? '<div class="badge">Мой товар</div>' : '';
        let btn = `<button class="btn" onclick="buy(${p.id})">Купить за ${p.price} TON</button>`;
        if(p.bought) btn = `<button class="btn green">Куплено</button>`;
        return `
          <div class="card">
            ${badge}
            ${p.img?`<img src="${p.img}">`:"<div style='height:120px;width:100%;background:#1e2235;border-radius:var(--radius);'></div>"}
            <div>${p.title}</div>
            <div>${p.price} TON</div>
            ${btn}
          </div>
        `;
      }).join("");
    }

    function renderAdd(){
      main.innerHTML=`
        <div class="card" style="max-width:400px;margin:0 auto;">
          <h3>Добавить товар</h3>
          <input id="title" placeholder="Название">
          <input id="price" type="number" placeholder="Цена в TON">
          <input id="img" type="file" accept="image/*">
          <button class="btn" onclick="addProduct()">Опубликовать</button>
        </div>
      `;
    }

    function renderProfile(){
      main.innerHTML=`
        <div class="profile">
          <div class="balance">Баланс: ${balance} TON</div>
          <div class="history">
            <h3>История покупок</h3>
            <ul>${purchases.map(p=>`<li>${p.title} за ${p.price} TON</li>`).join("")||"<li>Нет покупок</li>"}</ul>
          </div>
          <div class="my-products">
            <h3>Мои товары</h3>
            <div class="grid">
              ${myProducts.map(p=>`
                <div class="card">
                  ${p.img?`<img src="${p.img}">`:""}
                  <div>${p.title}</div>
                  <div>${p.price} TON</div>
                  <button class="btn" onclick="openEdit(${p.id})">Изменить цену</button>
                  <button class="btn" onclick="removeProduct(${p.id})">Снять</button>
                </div>
              `).join("")||"<p>Вы ещё не добавили товары</p>"}
            </div>
          </div>
        </div>
      `;
    }

    function buy(id){
      const p=products.find(p=>p.id===id);
      if(p.bought||p.owner) return;
      if(balance<p.price){showToast("Недостаточно средств");return;}
      balance-=p.price;
      p.bought=true;
      purchases.push(p);
      showToast("Товар куплен!");
      renderHomeFiltered();
    }

    function addProduct(){
      const title=document.getElementById('title').value.trim();
      const price=parseInt(document.getElementById('price').value);
      const imgInput=document.getElementById('img');
      if(!title||!price){showToast("Заполните все поля");return;}
      const id=Date.now();
      const reader=new FileReader();
      reader.onload=()=>{
        const prod={id,title,price,owner:true,bought:false,img:reader.result};
        products.push(prod);
        myProducts.push(prod);
        showToast("Товар добавлен!");
        switchTab("home");
      };
      if(imgInput.files[0]) reader.readAsDataURL(imgInput.files[0]);
      else {
        const prod={id,title,price,owner:true,bought:false,img:""};
        products.push(prod);
        myProducts.push(prod);
        showToast("Товар добавлен!");
        switchTab("home");
      }
    }

    function openEdit(id){
      editProductId=id;
      modal.classList.add("active");
    }
    function confirmPriceChange(){
      const val=parseInt(newPriceInput.value);
      if(!val){showToast("Введите цену");return;}
      const prod=products.find(p=>p.id===editProductId);
      if(prod){prod.price=val;}
      const mine=myProducts.find(p=>p.id===editProductId);
      if(mine){mine.price=val;}
      showToast("Цена изменена");
      modal.classList.remove("active");
      renderProfile();
    }

    function removeProduct(id){
      if(!confirm("Удалить товар?")) return;
      products=products.filter(p=>p.id!==id);
      myProducts=myProducts.filter(p=>p.id!==id);
      showToast("Товар снят");
      renderProfile();
    }

    document.querySelectorAll('.tab').forEach(t=>t.addEventListener('click',()=>switchTab(t.dataset.tab)));
    switchTab("home");
  </script>
</body>
</html>
