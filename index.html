<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Tonfiles Market</title>
<style>
/* ---- Base ---- */
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{height:100%}
body{margin:0;font-family:Arial, Helvetica, sans-serif;background:#000;color:#fff;overflow-x:hidden}

/* ---- Header ---- */
.header{
  display:flex;justify-content:space-between;align-items:center;
  padding:12px 18px;background:#111;border-bottom:2px solid #0eff00;
}
.brand{display:flex;align-items:center;gap:12px}
.brand img{height:34px}
.balance{font-weight:800;color:#bfffbf;display:flex;align-items:center;gap:8px}
.balance img{width:14px;height:14px}

/* ---- Main ---- */
.container{max-width:1100px;margin:16px auto;padding:0 16px 120px}
.section{display:none}
.section.active{display:block}

/* ---- Inputs & Buttons ---- */
.input, textarea, select {
  background:#111;border:1px solid #0eff00;color:#fff;border-radius:8px;padding:10px;font-size:14px;
}
.input{min-width:120px}
.btn-primary{background:#0eff00;color:#000;padding:10px;border-radius:10px;border:0;font-weight:800;cursor:pointer}
.btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:#fff;padding:10px;border-radius:10px;cursor:pointer}
.small-btn{padding:8px;border-radius:8px;border:0;cursor:pointer}

/* focus */
button:focus,input:focus,textarea:focus,select:focus{outline:none;box-shadow:0 0 6px #0eff00}

/* ---- Bottom tabs ---- */
.tabs{position:fixed;left:0;right:0;bottom:0;background:#111;border-top:2px solid #0eff00;display:flex;z-index:90}
.tabs button{flex:1;padding:12px;border:0;background:transparent;color:#fff;cursor:pointer}
.tabs button.active{color:#0eff00;font-weight:800}

/* ---- Search / Filters ---- */
.search-block{display:flex;flex-direction:column;gap:10px;margin-bottom:12px}
.row1{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.row2{display:flex;gap:10px;flex-wrap:wrap}
.select{min-width:200px;padding:10px;border-radius:8px;border:1px solid rgba(14,255,0,0.06);background:#111;color:#fff}

/* ---- Grid / Cards ---- */
.grid{display:grid;gap:14px;grid-template-columns:repeat(auto-fill,minmax(220px,1fr))}
@media(max-width:860px){.grid{grid-template-columns:repeat(auto-fill,minmax(160px,1fr))}}
.card{background:#111;border:1px solid rgba(14,255,0,0.06);border-radius:12px;overflow:hidden;display:flex;flex-direction:column;height:340px;position:relative}
.card img{width:100%;height:180px;object-fit:cover}
.card-body{padding:12px;display:flex;flex-direction:column;gap:8px;flex:1}
.title{font-weight:800;font-size:16px;line-height:1.2;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.desc{color:#cfd6e9;font-size:13px;line-height:1.2;height:40px;overflow:hidden;word-break:break-word}
.info-line{display:flex;justify-content:space-between;align-items:center;font-size:13px;color:#aaa}
.actions{display:flex;gap:8px;margin-top:auto}

/* bought badge (small) */
.price-badge{position:absolute;right:10px;top:10px;background:#000;border:1px solid rgba(14,255,0,0.12);padding:6px 8px;border-radius:10px;font-weight:800}

/* ---- Modal ---- */
.modal{position:fixed;inset:0;background:rgba(0,0,0,0.8);display:none;align-items:center;justify-content:center;z-index:200}
.modal.show{display:flex}
.modal-card{background:#111;border-radius:12px;padding:16px;border:1px solid rgba(14,255,0,0.06);width:94%;max-width:900px;display:flex;gap:16px;flex-wrap:wrap}
.modal-left{flex:0 0 360px}
.modal-left img{width:100%;height:360px;object-fit:cover;border-radius:8px}
.modal-right{flex:1;display:flex;flex-direction:column}
.modal-actions{margin-top:auto;display:flex;gap:10px;flex-wrap:wrap}

/* ---- Profile ---- */
.profile-card{padding:12px;border-radius:10px;border:1px solid rgba(14,255,0,0.06);background:#111;min-width:240px}
.profile-tabs{display:flex;gap:8px;margin-bottom:12px}
.profile-tabs button{padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:#fff;cursor:pointer}
.profile-tabs button.active{background:#0eff00;color:#000;font-weight:800}
.profile-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px}

/* ---- Toast ---- */
.toast{position:fixed;right:18px;bottom:90px;background:#111;border:1px solid #0eff00;padding:10px 14px;border-radius:10px;opacity:0;transition:opacity .45s;z-index:300}
.toast.show{opacity:1}

/* misc */
.center{text-align:center}
.muted{color:#9aa3c7}
</style>
</head>
<body>

  <!-- Header -->
  <div class="header">
    <div class="brand"><img src="tonfiles.svg" alt="logo"><div style="font-weight:900">Tonfiles Market</div></div>
    <div class="balance"><span id="balance">1000.00</span><img src="ton1.svg" alt="TON"></div>
  </div>

  <!-- Main container -->
  <div class="container">

    <!-- HOME -->
    <section id="home" class="section active">
      <div class="search-block">
        <div class="row1">
          <input id="searchInput" class="input" placeholder="Поиск...">
          <select id="sortSelect" class="select">
            <option value="newest">Последние</option>
            <option value="price_asc">Цена: по возрастанию</option>
            <option value="price_desc">Цена: по убыванию</option>
            <option value="best">Отзывы: лучшие</option>
            <option value="count">Отзывы: количество</option>
          </select>
          <button class="btn-primary" id="applyBtn">Применить</button>
        </div>
        <div class="row2">
          <input id="minPrice" class="input" type="number" step="0.01" placeholder="Мин. цена">
          <input id="maxPrice" class="input" type="number" step="0.01" placeholder="Макс. цена">
        </div>
      </div>

      <div id="marketGrid" class="grid"></div>
    </section>

    <!-- ADD -->
    <section id="add" class="section">
      <div style="max-width:640px;margin:0 auto">
        <h2 class="center">Публикация объявления</h2>
        <div style="margin-bottom:12px">
          <label style="color:#0eff00;font-weight:700">Название</label>
          <input id="addName" class="input">
        </div>
        <div style="margin-bottom:12px">
          <label style="color:#0eff00;font-weight:700">Описание</label>
          <textarea id="addDesc" class="input" style="min-height:100px;resize:vertical"></textarea>
        </div>
        <div style="margin-bottom:12px">
          <label style="color:#0eff00;font-weight:700">Цена (TON)</label>
          <input id="addPrice" class="input" type="number" step="0.01" oninput="updateNet()">
          <div id="netText" class="muted" style="margin-top:6px"></div>
        </div>
        <div style="margin-bottom:12px">
          <label style="color:#0eff00;font-weight:700">Превью (картинка)</label>
          <input id="addPreview" type="file" accept="image/*" class="input">
        </div>
        <div style="margin-bottom:12px">
          <label style="color:#0eff00;font-weight:700">Файл для выдачи</label>
          <input id="addFile" type="file" class="input">
        </div>
        <div style="display:flex;gap:10px">
          <button class="btn-primary" id="publishBtn">Опубликовать</button>
          <button class="btn-ghost" id="clearAddBtn">Очистить</button>
        </div>
      </div>
    </section>

    <!-- PROFILE -->
    <section id="profile" class="section">
      <h2 class="center">Профиль</h2>

      <div style="display:flex;gap:12px;flex-wrap:wrap;margin-bottom:12px">
        <div class="profile-card">
          <div style="font-weight:800">Реферальная система</div>
          <div class="muted" style="margin-top:6px">2% от трат рефералов</div>
          <div style="margin-top:8px;font-weight:800;color:#bfffbf">Баланс: <span id="refBalance">0.00</span> <img src="ton1.svg" style="width:12px;height:12px;vertical-align:middle"></div>
          <div style="margin-top:10px"><button class="btn-primary" id="withdrawBtn">Вывести</button></div>
        </div>

        <div style="flex:1;min-width:260px">
          <div class="profile-tabs">
            <button id="tabPurchases" class="active" data-tab="purchases">Мои покупки</button>
            <button id="tabMyItems" data-tab="myitems">Мои товары</button>
          </div>

          <div style="margin-bottom:10px">
            <input id="profileSearch" class="input" placeholder="Поиск по покупкам...">
          </div>

          <div id="purchasesSection" class="profile-section active">
            <div id="purchasesGrid" class="profile-grid"></div>
            <div id="purchasesEmpty" class="muted center" style="padding:12px">Пусто</div>
          </div>

          <div id="myItemsSection" class="profile-section">
            <div id="myItemsGrid" class="profile-grid"></div>
            <div id="myItemsEmpty" class="muted center" style="padding:12px">Пусто</div>
          </div>
        </div>
      </div>
    </section>

  </div> <!-- container -->

  <!-- bottom navigation -->
  <div class="tabs">
    <button id="navHome" class="active" data-target="home">Главная</button>
    <button id="navAdd" data-target="add">Добавить</button>
    <button id="navProfile" data-target="profile">Профиль</button>
  </div>

  <!-- Modal -->
  <div id="modal" class="modal" aria-hidden="true">
    <div class="modal-card">
      <div class="modal-left"><img id="modalImg" src="" alt=""></div>
      <div class="modal-right">
        <h3 id="modalTitle"></h3>
        <div id="modalDesc" class="muted" style="margin-top:8px"></div>
        <div style="margin-top:12px;font-weight:800">Цена: <span id="modalPrice"></span> <img src="ton1.svg" style="width:14px;height:14px;vertical-align:middle"></div>

        <div id="modalActions" class="modal-actions"></div>

        <div id="modalRating" style="margin-top:12px"></div>

        <div style="margin-top:12px"><button class="btn-ghost" id="closeModalBtn">Закрыть</button></div>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast" role="status" aria-live="polite"></div>

<script>
/* ------------------ Demo in-memory state ------------------ */
let balance = 1000.00;
let refBalance = 0.00;
const userId = 1;
let purchases = [];     // purchased item ids
let myItems = [];       // ids of items created by me
let rated = [];         // ids of items user rated
let currentProfileTab = 'purchases';

/* sample items */
let items = [
  { id:101, name:"Скрипт Telegram Bot", desc:"Рабочий бот с оплатой и командами", price:15.00, img:"https://via.placeholder.com/800x600?text=Bot", file:"bot.zip", ownerId:2, reviews:[5,4] },
  { id:102, name:"Видеоурок по дизайну", desc:"UI/UX советы и примеры", price:8.50, img:"https://via.placeholder.com/800x600?text=Design", file:"design.mp4", ownerId:3, reviews:[5,4,5] },
  { id:103, name:"React шаблон", desc:"Адаптивный шаблон сайта", price:18.25, img:"https://via.placeholder.com/800x600?text=React", file:"site.zip", ownerId:5, reviews:[] }
];

/* helpers */
const $ = id => document.getElementById(id);
function showToast(msg){
  const t = $('toast'); t.textContent = msg; t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'), 2500);
}
function avg(arr){ return (arr && arr.length) ? (arr.reduce((a,b)=>a+b,0)/arr.length) : 0 }
function cut(text, n=40){ if(!text) return ''; return text.length>n ? text.slice(0,n-1)+'…' : text }

/* ---- Rendering functions ---- */
function renderMarket(){
  $('balance').textContent = balance.toFixed(2);
  $('refBalance').textContent = refBalance.toFixed(2);

  const q = ($('searchInput').value || '').trim().toLowerCase();
  const min = parseFloat($('minPrice').value) || 0;
  const max = parseFloat($('maxPrice').value) || Infinity;
  const sortVal = $('sortSelect').value;

  let list = items.filter(it=>{
    const hay = (it.name + ' ' + (it.desc||'')).toLowerCase();
    if(q && !hay.includes(q)) return false;
    if(it.price < min || it.price > max) return false;
    return true;
  });

  if(sortVal === 'price_asc') list.sort((a,b)=>a.price-b.price);
  else if(sortVal === 'price_desc') list.sort((a,b)=>b.price-a.price);
  else if(sortVal === 'best') list.sort((a,b)=> avg(b.reviews) - avg(a.reviews) );
  else if(sortVal === 'count') list.sort((a,b)=> b.reviews.length - a.reviews.length );
  else list.sort((a,b)=> b.id - a.id);

  const grid = $('marketGrid'); grid.innerHTML = '';
  if(list.length === 0){
    const emp = document.createElement('div'); emp.className='muted center'; emp.style.padding='24px'; emp.textContent='Ничего не найдено';
    grid.appendChild(emp); return;
  }

  list.forEach(it=>{
    const a = avg(it.reviews);
    const card = document.createElement('div'); card.className = 'card';
    // price badge
    const priceBadge = document.createElement('div'); priceBadge.className = 'price-badge';
    priceBadge.innerHTML = `${it.price.toFixed(2)} <img src="ton1.svg" style="width:12px;height:12px;vertical-align:middle">`;
    card.appendChild(priceBadge);
    // image
    const img = document.createElement('img'); img.src = it.img; img.alt = it.name; card.appendChild(img);
    // body
    const body = document.createElement('div'); body.className = 'card-body';
    const t = document.createElement('div'); t.className='title'; t.textContent = cut(it.name, 36);
    const d = document.createElement('div'); d.className='desc'; d.textContent = cut(it.desc, 80);
    body.appendChild(t); body.appendChild(d);
    // info line
    const info = document.createElement('div'); info.className = 'info-line';
    info.innerHTML = `<span>⭐ ${a.toFixed(1)} <span style="color:#999">(${it.reviews.length})</span></span><span style="font-weight:800">${it.price.toFixed(2)} <img src="ton1.svg" style="width:12px;height:12px;vertical-align:middle"></span>`;
    body.appendChild(info);
    // actions
    const act = document.createElement('div'); act.className = 'actions';
    const ownerFlag = (it.ownerId === userId);
    const boughtFlag = purchases.includes(it.id);
    if(ownerFlag){
      const btn = document.createElement('button'); btn.className='btn-ghost'; btn.textContent='Мой товар';
      act.appendChild(btn);
    } else if(boughtFlag){
      const b1 = document.createElement('button'); b1.className='small-btn'; b1.style.background='#333'; b1.style.color='#0eff00'; b1.style.flex='1'; b1.textContent='Приобретено';
      const b2 = document.createElement('button'); b2.className='small-btn'; b2.style.background='#0eff00'; b2.style.color='#000'; b2.style.flex='1'; b2.textContent='Получить файл';
      b2.addEventListener('click', ()=> downloadFileDemo(it));
      act.appendChild(b1); act.appendChild(b2);
    } else {
      const buy = document.createElement('button'); buy.className='btn-primary'; buy.textContent = `Купить ${it.price.toFixed(2)} TON`;
      buy.addEventListener('click', ()=> openModal(it.id));
      act.appendChild(buy);
    }
    body.appendChild(act);
    card.appendChild(body);
    grid.appendChild(card);
  });
}

function renderProfile(){
  $('refBalance').textContent = refBalance.toFixed(2);
  const q = ($('profileSearch').value || '').trim().toLowerCase();

  /* purchases */
  const pg = $('purchasesGrid'); pg.innerHTML = '';
  const purchasedList = items.filter(it => purchases.includes(it.id)).filter(it => (it.name + ' ' + it.desc).toLowerCase().includes(q));
  if(purchasedList.length === 0) $('purchasesEmpty').style.display = 'block'; else $('purchasesEmpty').style.display = 'none';
  purchasedList.forEach(it=>{
    const a = avg(it.reviews);
    const card = document.createElement('div'); card.className='card';
    const img = document.createElement('img'); img.src=it.img; card.appendChild(img);
    const body = document.createElement('div'); body.className='card-body';
    const t = document.createElement('div'); t.className='title'; t.textContent = cut(it.name,36);
    const d = document.createElement('div'); d.className='desc'; d.textContent = cut(it.desc,80);
    body.appendChild(t); body.appendChild(d);
    const info = document.createElement('div'); info.className='info-line'; info.innerHTML = `<span>⭐ ${a.toFixed(1)} <span style="color:#999">(${it.reviews.length})</span></span><span style="font-weight:800">${it.price.toFixed(2)} <img src="ton1.svg" style="width:12px;height:12px;vertical-align:middle"></span>`;
    body.appendChild(info);
    const act = document.createElement('div'); act.className='actions';
    const b1 = document.createElement('button'); b1.className='small-btn'; b1.style.background='#333'; b1.style.color='#0eff00'; b1.style.flex='1'; b1.textContent='Приобретено';
    const b2 = document.createElement('button'); b2.className='small-btn'; b2.style.background='#0eff00'; b2.style.color='#000'; b2.style.flex='1'; b2.textContent='Получить файл';
    b2.addEventListener('click', ()=> downloadFileDemo(it));
    act.appendChild(b1); act.appendChild(b2);
    body.appendChild(act);
    card.appendChild(body);
    pg.appendChild(card);
  });

  /* my items */
  const mg = $('myItemsGrid'); mg.innerHTML = '';
  const mylist = items.filter(it => it.ownerId === userId).filter(it => (it.name + ' ' + it.desc).toLowerCase().includes(q));
  if(mylist.length === 0) $('myItemsEmpty').style.display = 'block'; else $('myItemsEmpty').style.display = 'none';
  mylist.forEach(it=>{
    const card = document.createElement('div'); card.className='card';
    const img = document.createElement('img'); img.src = it.img; card.appendChild(img);
    const body = document.createElement('div'); body.className='card-body';
    const t = document.createElement('div'); t.className='title'; t.textContent = cut(it.name,36);
    const d = document.createElement('div'); d.className='desc'; d.textContent = cut(it.desc,80);
    body.appendChild(t); body.appendChild(d);
    const rm = document.createElement('button'); rm.className='small-btn'; rm.textContent='Снять'; rm.style.background='#333'; rm.style.color='#fff';
    rm.addEventListener('click', ()=> removeMyItem(it.id));
    body.appendChild(rm);
    card.appendChild(body);
    mg.appendChild(card);
  });
}

/* ---- Modal and item actions ---- */
function openModal(id){
  const it = items.find(x=>x.id===id); if(!it) return;
  $('modalImg').src = it.img;
  $('modalTitle').textContent = it.name;
  $('modalDesc').textContent = it.desc;
  $('modalPrice').textContent = it.price.toFixed(2);

  const actions = $('modalActions'); actions.innerHTML = '';
  const ownerFlag = (it.ownerId === userId);
  const boughtFlag = purchases.includes(it.id);
  if(ownerFlag){
    const b = document.createElement('button'); b.className='btn-ghost'; b.textContent='Мой товар'; actions.appendChild(b);
  } else if(boughtFlag){
    const b1 = document.createElement('button'); b1.className='btn-ghost'; b1.textContent='Приобретено'; actions.appendChild(b1);
    const b2 = document.createElement('button'); b2.className='btn-primary'; b2.textContent='Получить файл'; b2.addEventListener('click', ()=> downloadFileDemo(it)); actions.appendChild(b2);
  } else {
    const buy = document.createElement('button'); buy.className='btn-primary'; buy.textContent = `Купить ${it.price.toFixed(2)} TON`; buy.addEventListener('click', ()=> doBuy(it.id)); actions.appendChild(buy);
  }

  // rating area (only if purchased & not rated & not owner)
  const ratingWrap = $('modalRating'); ratingWrap.innerHTML = `Рейтинг: ${avg(it.reviews).toFixed(1)} ⭐ (${it.reviews.length})`;
  if(purchases.includes(it.id) && !rated.includes(it.id) && it.ownerId !== userId){
    const starsRow = document.createElement('div'); starsRow.style.marginTop = '8px';
    for(let s=1;s<=5;s++){
      const sp = document.createElement('span'); sp.textContent = '★'; sp.style.cursor='pointer'; sp.style.fontSize='20px'; sp.style.marginRight='6px';
      sp.addEventListener('click', ()=> submitRating(it.id, s));
      starsRow.appendChild(sp);
    }
    ratingWrap.appendChild(starsRow);
  }

  $('modal').classList.add('show');
}
function closeModal(){ $('modal').classList.remove('show'); }

function doBuy(id){
  const it = items.find(x=>x.id===id); if(!it) return;
  if(balance < it.price){ showToast('Недостаточно средств'); return; }
  balance = Math.round((balance - it.price)*100)/100;
  refBalance = Math.round((refBalance + it.price*0.02)*100)/100;
  purchases.push(it.id);
  showToast('Покупка успешна — файл доступен в модалке и в профиле');
  closeModal(); renderMarket(); renderProfile();
}

function submitRating(itemId, val){
  const it = items.find(x=>x.id===itemId); if(!it) return;
  if(!purchases.includes(itemId)){ showToast('Нельзя оценить не купив товар'); return; }
  if(it.ownerId === userId){ showToast('Нельзя оценивать свой товар'); return; }
  if(rated.includes(itemId)){ showToast('Вы уже оценили этот товар'); return; }
  it.reviews.push(val); rated.push(itemId);
  showToast('Спасибо за оценку!');
  closeModal(); renderMarket(); renderProfile();
}

/* demo download */
function downloadFileDemo(item){
  const blob = new Blob([`Демо-файл: ${item.file}\n(сгенерирован фронтендом)`], {type:'text/plain'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download = item.file || 'file.txt'; document.body.appendChild(a); a.click(); a.remove();
  URL.revokeObjectURL(url);
}

/* ---- Publish / Remove ---- */
function updateNet(){ const p = parseFloat($('addPrice').value) || 0; $('netText').textContent = `Вы получите ${(p*0.9).toFixed(2)} TON (после комиссии 10%)`; }
function publish(){
  const name = $('addName').value.trim();
  const desc = $('addDesc').value.trim();
  const price = parseFloat($('addPrice').value) || 0;
  const preview = $('addPreview').files[0];
  const file = $('addFile').files[0];
  if(!name || !desc || !price || !preview || !file){ showToast('Заполните все поля и загрузите файлы'); return; }
  const reader = new FileReader();
  reader.onload = (e) => {
    const newItem = { id: Date.now() + Math.floor(Math.random()*1000), name, desc, price, img: e.target.result, file: file.name, ownerId: userId, reviews: [] };
    items.unshift(newItem);
    myItems.push(newItem.id);
    showToast('Товар опубликован (демо)');
    clearAdd(); goTab('home'); renderMarket();
  };
  reader.readAsDataURL(preview);
}
function clearAdd(){ $('addName').value=''; $('addDesc').value=''; $('addPrice').value=''; $('addPreview').value=''; $('addFile').value=''; $('netText').textContent=''; }
function removeMyItem(id){
  if(!confirm('Снять товар?')) return;
  items = items.filter(x=>x.id!==id);
  myItems = myItems.filter(x=>x!==id);
  showToast('Товар снят');
  renderProfile(); renderMarket();
}

/* withdraw */
function withdrawRef(){
  if(refBalance <= 0){ showToast('Нет средств'); return; }
  balance = Math.round((balance + refBalance)*100)/100; refBalance = 0;
  showToast('Вывод успешен'); renderMarket(); renderProfile();
}

/* ---- Navigation & events ---- */
function goTab(id){
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('.tabs button').forEach(b=>b.classList.remove('active'));
  document.querySelector(`.tabs button[data-target="${id}"]`)?.classList.add('active');
  if(id === 'profile') renderProfile();
  renderMarket();
}

/* profile tab handling */
document.querySelectorAll('.profile-tabs button').forEach(btn=>{
  btn.addEventListener('click', ()=> {
    document.querySelectorAll('.profile-tabs button').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    const tab = btn.dataset.tab;
    currentProfileTab = tab;
    document.getElementById('purchasesSection').classList.toggle('active', tab === 'purchases');
    document.getElementById('myItemsSection').classList.toggle('active', tab === 'myitems');
    $('profileSearch').placeholder = tab === 'purchases' ? 'Поиск по покупкам...' : 'Поиск по товарам...';
    renderProfile();
  });
});

/* bottom tabs */
document.querySelectorAll('.tabs button').forEach(btn=>{
  btn.addEventListener('click', ()=> {
    document.querySelectorAll('.tabs button').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    const target = btn.dataset.target || btn.getAttribute('data-target');
    if(target) {
      document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
      document.getElementById(target).classList.add('active');
      if(target==='profile') renderProfile();
    }
    renderMarket();
  });
});

/* apply & other handlers */
$('applyBtn').addEventListener('click', ()=> renderMarket());
$('publishBtn').addEventListener('click', publish);
$('clearAddBtn').addEventListener('click', clearAdd);
$('withdrawBtn').addEventListener('click', withdrawRef);
$('closeModalBtn').addEventListener('click', closeModal);

/* profile search input */
$('profileSearch').addEventListener('input', ()=> renderProfile());

/* initial demo: add one item owned by me and one purchased */
(function initDemo(){
  const mine = { id:999, name:'Мой гайд (demo)', desc:'Товар, опубликованный мной', price:5.00, img:'https://via.placeholder.com/800x600?text=My+Guide', file:'guide.pdf', ownerId: userId, reviews:[5] };
  items.unshift(mine); myItems.push(mine.id);
  // mark item 101 (if exists) as purchased for demo
  if(items.find(i=>i.id===101)) purchases.push(101);
  renderMarket(); renderProfile();
})();

/* small utility for goTab from code */
function goTabFromNav(id){ goTab(id); }

/* helper used in some inline handlers (if present) */
window.openModal = function(id){ openModal(id); };

</script>
</body>
</html>
