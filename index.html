<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tonfiles Market</title>
  <style>
    :root {
      --bg: #0f1220;
      --card: #171a2a;
      --text: #e8ebff;
      --muted: #9aa3c7;
      --accent: #6ea8ff;
      --success: #22c55e;
      --radius: 16px;
      --shadow: 0 6px 18px rgba(0,0,0,0.25);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: sans-serif;
      background: var(--bg);
      color: var(--text);
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow: hidden;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 16px;
      background: var(--card);
      box-shadow: var(--shadow);
    }
    header img.logo { height: 28px; }
    header .balance {
      display: flex;
      align-items: center;
      gap: 6px;
      font-weight: bold;
      background: #1e2235;
      padding: 6px 12px;
      border-radius: var(--radius);
    }
    header .balance img { height: 16px; width: 16px; object-fit: contain; }
    main { flex: 1; overflow-y: auto; padding: 16px; }
    .tabs {
      display: flex;
      justify-content: space-around;
      background: var(--card);
      padding: 10px 0;
      box-shadow: var(--shadow);
    }
    .tabs button {
      flex: 1;
      background: none;
      border: none;
      color: var(--text);
      font-size: 14px;
      font-weight: bold;
      padding: 8px;
      cursor: pointer;
    }
    .tabs button.active {
      color: var(--accent);
      border-bottom: 2px solid var(--accent);
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
    }
    .card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 12px;
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      cursor: pointer;
      transition: transform 0.2s ease;
    }
    .card:hover { transform: scale(1.02); }
    .card img {
      width: 100%;
      height: 140px;
      object-fit: cover;
      border-radius: var(--radius);
    }
    .card h3 { margin: 10px 0 6px; font-size: 15px; font-weight: bold; }
    .card p { font-size: 13px; color: var(--muted); flex-grow: 1; }
    .buy-btn {
      margin-top: 10px;
      padding: 10px;
      border: none;
      border-radius: var(--radius);
      font-weight: bold;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .buy-btn img { height: 14px; width: 14px; object-fit: contain; }
    .buy { background: var(--accent); color: #fff; }
    .owned { background: var(--success); color: #fff; }
    .mine { background: #333; color: var(--muted); cursor: default; }
    /* Modal */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.7);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal.active { display: flex; }
    .modal-content {
      background: var(--card);
      border-radius: var(--radius);
      padding: 20px;
      max-width: 500px;
      width: 90%;
      box-shadow: var(--shadow);
    }
    .modal-content img {
      width: 100%;
      max-height: 240px;
      object-fit: contain;
      border-radius: var(--radius);
    }
    .modal-content h2 { margin: 12px 0; }
    .modal-content p { font-size: 14px; color: var(--muted); }
    .modal-actions { margin-top: 14px; display: flex; gap: 10px; }
    /* Add product */
    form { display: flex; flex-direction: column; gap: 12px; }
    form input, form textarea {
      padding: 10px;
      border-radius: var(--radius);
      border: none;
      background: #1e2235;
      color: var(--text);
      font-size: 14px;
      width: 100%;
    }
    form .files { display: flex; gap: 10px; }
    form .files button {
      flex: 1;
      padding: 10px;
      background: var(--card);
      border: 1px dashed var(--muted);
      color: var(--muted);
      border-radius: var(--radius);
      cursor: pointer;
    }
    form .note { font-size: 13px; color: var(--muted); }
    form button[type="submit"] {
      background: var(--accent);
      color: #fff;
      padding: 12px;
      border: none;
      border-radius: var(--radius);
      font-weight: bold;
      cursor: pointer;
    }
    h2 { margin: 10px 0; }
    .empty { color: var(--muted); font-size: 14px; margin: 10px 0; }
  </style>
</head>
<body>
  <header>
    <img src="tonfiles.svg" class="logo" alt="logo"/>
    <div class="balance" id="balance">1000 <img src="ton1.svg" alt="TON"/></div>
  </header>

  <main id="content"></main>

  <div class="tabs">
    <button id="tab-home" class="active">Главная</button>
    <button id="tab-add">Добавить</button>
    <button id="tab-profile">Профиль</button>
  </div>

  <!-- Modal -->
  <div class="modal" id="modal">
    <div class="modal-content">
      <img id="modal-img" src="" alt="">
      <h2 id="modal-title"></h2>
      <p id="modal-desc"></p>
      <div class="modal-actions" id="modal-actions"></div>
    </div>
  </div>

  <script>
    let balance = 1000;
    let products = [
      {id:1, title:"Тестовый товар", desc:"Описание тестового товара.", price:25.5, img:"https://via.placeholder.com/300x200", owner:"other"},
    ];
    let myProducts = [];
    let bought = [];

    const balanceEl = document.getElementById("balance");
    function updateBalance() {
      balanceEl.innerHTML = balance.toFixed(2) + ' <img src="ton1.svg" alt="TON"/>';
    }

    const content = document.getElementById("content");
    const modal = document.getElementById("modal");
    const modalImg = document.getElementById("modal-img");
    const modalTitle = document.getElementById("modal-title");
    const modalDesc = document.getElementById("modal-desc");
    const modalActions = document.getElementById("modal-actions");

    function renderHome() {
      content.innerHTML = '<div class="grid">' + products.map(p => `
        <div class="card" onclick="openModal(${p.id})">
          <img src="${p.img}" alt="">
          <h3>${p.title}</h3>
          <p>${p.desc}</p>
          ${renderButton(p)}
        </div>`).join('') + '</div>';
    }

    function renderButton(p) {
      if (p.owner === "me") {
        return `<button class="buy-btn mine">Мой товар</button>`;
      } else if (bought.includes(p.id)) {
        return `<button class="buy-btn owned">Приобретено</button>`;
      } else {
        return `<button class="buy-btn buy" onclick="event.stopPropagation(); buyProduct(${p.id})">
                  Купить <span>${p.price.toFixed(2)} <img src="ton1.svg" alt="TON"/></span>
                </button>`;
      }
    }

    function openModal(id) {
      const p = products.find(x=>x.id===id);
      modalImg.src = p.img;
      modalTitle.textContent = p.title;
      modalDesc.textContent = p.desc;
      modalActions.innerHTML = renderButton(p);
      modal.classList.add("active");
    }
    modal.addEventListener("click", e=>{ if(e.target===modal) modal.classList.remove("active"); });

    function renderAdd() {
      content.innerHTML = `
        <form onsubmit="addProduct(event)">
          <input type="text" id="title" placeholder="Название" required>
          <textarea id="desc" rows="3" placeholder="Описание" required></textarea>
          <input type="number" id="price" placeholder="Цена (TON)" step="0.01" required oninput="updateCommission()">
          <div class="note" id="commission">Вы получите 0 TON (с учётом комиссии маркетплейса 10%)</div>
          <label>Загрузка файлов:</label>
          <div class="files">
            <button type="button">Превью</button>
            <button type="button">Конечный файл</button>
          </div>
          <button type="submit">Опубликовать</button>
        </form>`;
    }

    function updateCommission() {
      const val = parseFloat(document.getElementById("price").value);
      const com = isNaN(val) ? 0 : (val*0.9).toFixed(2);
      document.getElementById("commission").innerText = `Вы получите ${com} TON (с учётом комиссии маркетплейса 10%)`;
    }

    function addProduct(e) {
      e.preventDefault();
      const id = Date.now();
      const title = document.getElementById("title").value;
      const desc = document.getElementById("desc").value;
      const price = parseFloat(document.getElementById("price").value).toFixed(2);
      const img = "https://via.placeholder.com/300x200"; // Заглушка вместо превью
      const product = {id, title, desc, price:parseFloat(price), img, owner:"me"};
      products.push(product);
      myProducts.push(product);
      renderHome();
      alert("Товар опубликован!");
    }

    function renderProfile() {
      let html = '<h2>Мои товары</h2>';
      if(myProducts.length===0) {
        html += '<div class="empty">ничего не найдено</div>';
      } else {
        html += '<div class="grid">' + myProducts.map(p => `
          <div class="card">
            <img src="${p.img}" alt="">
            <h3>${p.title}</h3>
            <p>${p.desc}</p>
            <button class="buy-btn mine">Мой товар</button>
          </div>`).join('') + '</div>';
      }
      html += '<h2>Мои покупки</h2>';
      const purchases = products.filter(p=>bought.includes(p.id));
      if(purchases.length===0) {
        html += '<div class="empty">ничего не найдено</div>';
      } else {
        html += '<div class="grid">' + purchases.map(p => `
          <div class="card">
            <img src="${p.img}" alt="">
            <h3>${p.title}</h3>
            <p>${p.desc}</p>
            <button class="buy-btn owned">Приобретено</button>
          </div>`).join('') + '</div>';
      }
      content.innerHTML = html;
    }

    function buyProduct(id) {
      const p = products.find(x=>x.id===id);
      if(balance>=p.price) {
        balance -= p.price;
        bought.push(p.id);
        updateBalance();
        renderHome();
        modal.classList.remove("active");
      } else {
        alert("Недостаточно средств!");
      }
    }

    document.getElementById("tab-home").onclick = ()=>{ setActive("home"); renderHome(); };
    document.getElementById("tab-add").onclick = ()=>{ setActive("add"); renderAdd(); };
    document.getElementById("tab-profile").onclick = ()=>{ setActive("profile"); renderProfile(); };

    function setActive(tab) {
      document.querySelectorAll(".tabs button").forEach(b=>b.classList.remove("active"));
      document.getElementById("tab-"+tab).classList.add("active");
    }

    // Init
    updateBalance();
    renderHome();
  </script>
</body>
</html>
