<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>TONFiles Market</title>
<style>
:root {
  --bg:#0e111a; --card:#171b26; --text:#e8ebff; --muted:#9aa3c7;
  --accent:#3b82f6; --accent-2:#7c3aed; --success:#22c55e;
  --radius:16px; --shadow:0 8px 24px rgba(0,0,0,0.25);
}
body{margin:0; font-family:sans-serif; background:var(--bg); color:var(--text); overflow-x:hidden;}
h2{margin:12px 0; font-size:20px;}
.wrap{max-width:900px; margin:0 auto; padding:16px;}
.hidden{display:none;}
/* –≤–∫–ª–∞–¥–∫–∏ */
.tab-bar{
  position:fixed; bottom:0; left:0; width:100%; height:60px;
  background:#1b1f2e; display:flex; justify-content:space-around; align-items:center;
  box-shadow:0 -2px 10px rgba(0,0,0,0.4); z-index:999;
}
.tab-btn{flex:1; text-align:center; color:var(--muted); font-size:14px; cursor:pointer; padding:6px;}
.tab-btn.active{color:var(--accent); font-weight:600;}
/* –∫–∞—Ä—Ç–æ—á–∫–∏ */
.grid{display:grid; gap:16px;}
@media(min-width:600px){.grid{grid-template-columns:repeat(2,1fr);}}
@media(min-width:900px){.grid{grid-template-columns:repeat(3,1fr);}}
.card{
  background:var(--card); border-radius:var(--radius); padding:14px;
  box-shadow:var(--shadow); display:flex; flex-direction:column; gap:10px;
  text-align:center; align-items:center; transition:transform .2s;
}
.card:hover{transform:scale(1.03);}
.card img{max-width:100%; border-radius:var(--radius);}
.card h3{margin:6px 0;font-size:16px;}
.card p{margin:0;font-size:14px; color:var(--muted);}
.price{font-weight:600; margin:6px 0;}
/* –∫–Ω–æ–ø–∫–∏ */
.btn{
  padding:10px 14px; border-radius:12px; border:none; cursor:pointer;
  background:linear-gradient(135deg,var(--accent),var(--accent-2)); color:white; font-weight:600;
  box-shadow:var(--shadow); transition:opacity .2s;
}
.btn:hover{opacity:0.9;}
.btn:disabled{opacity:0.6; cursor:not-allowed;}
.btn.success{
  background:var(--success); color:white; cursor:default;
}
/* —Ñ–æ—Ä–º–∞ */
form{display:flex; flex-direction:column; gap:12px;}
input,textarea,select{
  padding:10px; border-radius:10px; border:none; outline:none;
  background:#1e2235; color:var(--text); font-size:14px;
}
textarea{resize:none; min-height:80px;}
.preview-img{max-width:100%; border-radius:var(--radius); margin-top:10px;}
/* –ø—Ä–æ—Ñ–∏–ª—å */
.stat-box{
  background:var(--card); border-radius:var(--radius); padding:14px; margin-bottom:12px;
  box-shadow:var(--shadow);
}
.purchase-grid{
  display:grid; gap:16px;
  grid-template-columns:repeat(2,1fr);
}
.purchase-card{
  background:var(--card); border-radius:var(--radius); padding:10px;
  box-shadow:var(--shadow); display:flex; flex-direction:column; align-items:center; text-align:center;
}
.purchase-card img{max-width:100%; border-radius:var(--radius);}
.purchase-card h4{margin:6px 0;font-size:15px;}
.purchase-card p{margin:0;font-size:13px; color:var(--muted);}
</style>
</head>
<body>

<!-- –ì–ª–∞–≤–Ω–∞—è -->
<section id="tab-home" class="wrap">
  <h2>–ú–∞—Ä–∫–µ—Ç</h2>
  <div style="margin-bottom:12px;">
    <input type="text" id="searchInput" placeholder="üîç –ü–æ–∏—Å–∫..." style="width:100%;">
  </div>
  <div style="margin-bottom:12px;">
    <select id="sortSelect" style="width:100%;">
      <option value="new">–°–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ</option>
      <option value="cheap">–°–Ω–∞—á–∞–ª–∞ –¥–µ—à—ë–≤—ã–µ</option>
      <option value="exp">–°–Ω–∞—á–∞–ª–∞ –¥–æ—Ä–æ–≥–∏–µ</option>
    </select>
  </div>
  <div class="grid" id="productsGrid"></div>
</section>

<!-- –î–æ–±–∞–≤–∏—Ç—å -->
<section id="tab-add" class="wrap hidden">
  <h2>–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h2>
  <form id="addForm">
    <input type="text" id="titleInput" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" required>
    <textarea id="descInput" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" required></textarea>
    <input type="number" id="priceInput" placeholder="–¶–µ–Ω–∞ (TON)" min="1" required>
    <input type="file" id="imageInput" accept="image/*">
    <img id="previewImg" class="preview-img hidden" alt="–ü—Ä–µ–≤—å—é">
    <button class="btn" type="submit">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
  </form>
</section>

<!-- –ü—Ä–æ—Ñ–∏–ª—å -->
<section id="tab-profile" class="wrap hidden">
  <h2>–ü—Ä–æ—Ñ–∏–ª—å</h2>
  <div class="stat-box">
    <strong>–í–∞—à –±–∞–ª–∞–Ω—Å:</strong> <span id="balance">1000 TON</span>
  </div>
  <div class="stat-box">
    <strong>–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞:</strong>
    <p id="refLink">https://tonfiles.market/ref/12345</p>
    <small>–ü—Ä–∏–≥–ª–∞—à–∞–π—Ç–µ –¥—Ä—É–∑–µ–π –∏ –ø–æ–ª—É—á–∞–π—Ç–µ 10% —Å –∏—Ö –ø—Ä–æ–¥–∞–∂!</small>
  </div>
  <div class="stat-box">
    <strong>–ú–æ–∏ —Ç–æ–≤–∞—Ä—ã:</strong>
    <ul id="myProducts"></ul>
  </div>
  <div class="stat-box">
    <strong>–ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫—É–ø–æ–∫:</strong>
    <div class="purchase-grid" id="purchaseHistory"></div>
  </div>
</section>

<!-- –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
<div class="tab-bar">
  <div class="tab-btn active" data-tab="home">üè† –ì–ª–∞–≤–Ω–∞—è</div>
  <div class="tab-btn" data-tab="add">‚ûï –î–æ–±–∞–≤–∏—Ç—å</div>
  <div class="tab-btn" data-tab="profile">üë§ –ü—Ä–æ—Ñ–∏–ª—å</div>
</div>

<script>
let products = JSON.parse(localStorage.getItem("products")||"[]");
let purchases = JSON.parse(localStorage.getItem("purchases")||"[]");
let balance = 1000; // —Ç–µ—Å—Ç–æ–≤—ã–π –±–∞–ª–∞–Ω—Å

// –≤–∫–ª–∞–¥–∫–∏
document.querySelectorAll(".tab-btn").forEach(btn=>{
  btn.addEventListener("click",()=>{
    document.querySelectorAll("section").forEach(s=>s.classList.add("hidden"));
    document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("active"));
    document.getElementById("tab-"+btn.dataset.tab).classList.remove("hidden");
    btn.classList.add("active");
    if(btn.dataset.tab==="profile") renderProfile();
  });
});

// –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫—É–ø–ª–µ–Ω –ª–∏ —Ç–æ–≤–∞—Ä
function isPurchased(title){
  return purchases.some(ph=>ph.title===title);
}

// –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤
function renderProducts(){
  const q=document.getElementById("searchInput").value.toLowerCase();
  const sort=document.getElementById("sortSelect").value;
  let list=[...products].filter(p=>p.title.toLowerCase().includes(q)||p.desc.toLowerCase().includes(q));
  if(sort==="cheap") list.sort((a,b)=>a.price-b.price);
  if(sort==="exp") list.sort((a,b)=>b.price-a.price);
  if(sort==="new") list=list.reverse();
  document.getElementById("productsGrid").innerHTML=list.map((p,i)=>{
    const bought=isPurchased(p.title);
    return `
    <div class="card">
      ${p.image?`<img src="${p.image}" alt="preview">`:""}
      <h3>${p.title}</h3>
      <p>${p.desc}</p>
      <div class="price">${p.price} TON</div>
      ${bought
        ? `<button class="btn success" disabled>–ö—É–ø–ª–µ–Ω–æ</button>`
        : `<button class="btn" onclick="buyProduct(${i})">–ö—É–ø–∏—Ç—å</button>`}
    </div>
    `;
  }).join("");
}

// –ø–æ–∫—É–ø–∫–∞
function buyProduct(i){
  const p=products[i];
  if(balance>=p.price){
    balance-=p.price;
    const purchase={title:p.title,desc:p.desc,price:p.price,image:p.image,date:new Date().toLocaleString()};
    purchases.push(purchase);
    localStorage.setItem("purchases",JSON.stringify(purchases));
    alert("–í—ã –∫—É–ø–∏–ª–∏: "+p.title+" –∑–∞ "+p.price+" TON");
    document.getElementById("balance").innerText=balance+" TON";
    renderProfile();
    renderProducts();
  } else {
    alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!");
  }
}

// —Ñ–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
const form=document.getElementById("addForm");
const imgInput=document.getElementById("imageInput");
const preview=document.getElementById("previewImg");
let newImage="";

imgInput.addEventListener("change",()=>{
  const file=imgInput.files[0];
  if(file){
    const reader=new FileReader();
    reader.onload=e=>{
      newImage=e.target.result;
      preview.src=newImage;
      preview.classList.remove("hidden");
    };
    reader.readAsDataURL(file);
  }
});

form.addEventListener("submit",e=>{
  e.preventDefault();
  const title=document.getElementById("titleInput").value.trim();
  const desc=document.getElementById("descInput").value.trim();
  const price=parseFloat(document.getElementById("priceInput").value);
  if(!title || !desc || !price){alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!");return;}
  products.push({title,desc,price,image:newImage});
  localStorage.setItem("products",JSON.stringify(products));
  form.reset(); preview.classList.add("hidden"); newImage="";
  alert("–¢–æ–≤–∞—Ä –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω!");
  renderProducts();
  document.querySelector("[data-tab='home']").click();
});

// –ø—Ä–æ—Ñ–∏–ª—å
function renderProfile(){
  document.getElementById("balance").innerText=balance+" TON";
  document.getElementById("myProducts").innerHTML=products.map(p=>`<li>${p.title} ‚Äî ${p.price} TON</li>`).join("");
  const ph=document.getElementById("purchaseHistory");
  ph.innerHTML=purchases.length
    ? purchases.map(p=>`
      <div class="purchase-card">
        ${p.image?`<img src="${p.image}" alt="preview">`:""}
        <h4>${p.title}</h4>
        <p>${p.price} TON</p>
        <small>${p.date}</small>
      </div>
    `).join("")
    : "<p>–ù–µ—Ç –ø–æ–∫—É–ø–æ–∫</p>";
}

// —Ñ–∏–ª—å—Ç—Ä—ã
document.getElementById("searchInput").addEventListener("input",renderProducts);
document.getElementById("sortSelect").addEventListener("change",renderProducts);

renderProducts();
</script>
</body>
</html>
