<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>TONFiles Market — demo</title>
<style>
:root{
  --bg:#070707;
  --surface:#121213;
  --card:#151515;
  --muted:#9aa0a6;
  --text:#eaf0f6;
  --accent:#0eff00;
  --radius:12px;
  --shadow:0 8px 30px rgba(0,0,0,0.6);
}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:Inter,Segoe UI,Roboto,Arial,sans-serif}
button,input,textarea{font:inherit}
button:focus,input:focus,textarea:focus{outline:none}
a{text-decoration:none;color:inherit}
.app{max-width:1100px;margin:0 auto;padding:12px}

/* header */
.header{display:flex;justify-content:space-between;align-items:center;padding:12px}
.brand{display:flex;align-items:center;gap:12px}
.brand img{height:36px}
.balance{display:flex;align-items:center;gap:6px;padding:6px 12px;border-radius:999px;border:1px solid rgba(14,255,0,0.3);color:var(--accent);font-weight:700}
.balance img{height:18px}

/* nav tabs */
.nav{display:flex;gap:12px;justify-content:center;margin:10px 0}
.nav button{flex:1;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.1);background:#0d0d0d;color:var(--muted);cursor:pointer;font-weight:700}
.nav button.active{background:var(--accent);color:#021;}

/* panels */
.panel{display:none}
.panel.active{display:block}

/* grid */
.grid{display:grid;gap:14px;grid-template-columns:repeat(auto-fill,minmax(240px,1fr))}
.card{background:var(--card);border-radius:12px;padding:10px;box-shadow:var(--shadow);display:flex;flex-direction:column;gap:8px;justify-content:space-between;height:280px;cursor:pointer}
.thumb{width:100%;height:140px;border-radius:8px;object-fit:cover;background:#0b0b0b}
.title{font-size:15px;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.desc{font-size:13px;color:var(--muted);line-height:1.2;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;word-break:break-word;overflow-wrap:anywhere}
.footer{display:flex;gap:8px;margin-top:auto}
.btn{flex:1;padding:8px;border-radius:8px;font-weight:700;cursor:pointer;border:none}
.btn-buy{background:var(--accent);color:#021}
.btn-owned{background:#0bbf44;color:#021}
.btn-mine{background:#0d0d0d;color:var(--muted);border:1px solid rgba(255,255,255,0.1)}

/* form */
.form-row{display:flex;flex-direction:column;gap:8px;margin:12px 0}
.input,textarea{padding:10px;border-radius:8px;border:none;background:#0d0d0d;color:var(--text)}
.note{font-size:13px;color:var(--muted)}
.preview{height:140px;border-radius:8px;background:#0b0b0b;display:flex;align-items:center;justify-content:center;color:var(--muted);overflow:hidden}
.preview img{width:100%;height:100%;object-fit:cover}

/* modal */
.modal{position:fixed;left:0;top:0;right:0;bottom:0;background:rgba(0,0,0,0.75);display:none;align-items:center;justify-content:center;z-index:999}
.modal.show{display:flex}
.modal-card{background:#121213;padding:18px;border-radius:12px;width:95%;max-width:800px;box-shadow:var(--shadow);display:flex;flex-wrap:wrap;gap:12px}
.modal-card img{width:100%;max-width:360px;height:280px;object-fit:cover;border-radius:8px}
.modal-info{flex:1;min-width:200px}
.modal-actions{display:flex;gap:8px;margin-top:12px}
.toast{position:fixed;right:20px;bottom:100px;background:var(--accent);color:#021;padding:10px 14px;border-radius:8px;font-weight:700;box-shadow:var(--shadow);display:none}
</style>
</head>
<body>
<div class="app">
  <header class="header">
    <div class="brand">
      <img src="tonfiles.svg" alt="logo">
      <div>
        <div style="font-weight:900">TONFiles Market</div>
        <div style="font-size:13px;color:var(--muted)">Demo (локально)</div>
      </div>
    </div>
    <div class="balance" id="balance">1000 <img src="ton1.svg"></div>
  </header>

  <nav class="nav">
    <button id="tabCatalog" class="active">Каталог</button>
    <button id="tabAdd">Добавить</button>
    <button id="tabProfile">Профиль</button>
  </nav>

  <!-- catalog -->
  <div id="catalogPanel" class="panel active">
    <div class="grid" id="catalog"></div>
  </div>

  <!-- add -->
  <div id="addPanel" class="panel">
    <div class="form-row"><input id="title" class="input" placeholder="Название"></div>
    <div class="form-row"><textarea id="desc" class="input" placeholder="Описание"></textarea></div>
    <div class="form-row"><input id="price" class="input" type="number" step="0.01" placeholder="Цена (TON)"></div>
    <div class="note">Вы получите: <span id="net">0</span> TON</div>
    <div class="form-row">
      <label>Превью: <input type="file" id="thumb" accept="image/*"></label>
      <div class="preview" id="thumbPreview">Нет превью</div>
    </div>
    <div class="form-row"><label>Файл: <input type="file" id="asset"></label></div>
    <div class="form-row"><button id="publish" class="btn btn-buy">Опубликовать</button></div>
  </div>

  <!-- profile -->
  <div id="profilePanel" class="panel">
    <h3>Мои покупки</h3>
    <div class="grid" id="purchases"></div>
    <h3>Мои товары</h3>
    <div class="grid" id="myproducts"></div>
  </div>
</div>

<!-- modal -->
<div id="modal" class="modal"><div class="modal-card">
  <div><img id="modalImg"></div>
  <div class="modal-info">
    <h3 id="modalTitle"></h3>
    <div id="modalDesc" style="color:var(--muted);margin-top:6px"></div>
    <div style="margin-top:10px;font-weight:700"><span id="modalPrice"></span> TON</div>
    <div class="modal-actions" id="modalActions"></div>
    <button id="closeModal" class="btn" style="margin-top:10px;background:#0d0d0d;color:var(--muted)">Закрыть</button>
  </div>
</div></div>

<div id="toast" class="toast"></div>

<script>
const KEY_PRODUCTS='tf_products_v4',KEY_PURCHASES='tf_purchases_v4',KEY_BAL='tf_balance_v4',KEY_USER='tf_user_v4';
let meId=localStorage.getItem(KEY_USER);if(!meId){meId='u'+Date.now();localStorage.setItem(KEY_USER,meId);}
let products=JSON.parse(localStorage.getItem(KEY_PRODUCTS)||'[]');
let purchases=JSON.parse(localStorage.getItem(KEY_PURCHASES)||'[]');
let balance=parseFloat(localStorage.getItem(KEY_BAL)||'1000');
function save(){localStorage.setItem(KEY_PRODUCTS,JSON.stringify(products));localStorage.setItem(KEY_PURCHASES,JSON.stringify(purchases));localStorage.setItem(KEY_BAL,balance);}
function fmt(n){return Number(n).toFixed(2).replace(/\.00$/,'');}
function toast(t){const el=document.getElementById('toast');el.textContent=t;el.style.display='block';setTimeout(()=>el.style.display='none',2000);}
function updateBal(){document.getElementById('balance').innerHTML=fmt(balance)+' <img src="ton1.svg">';save();}

/* tabs */
function show(panel){document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));document.querySelectorAll('.nav button').forEach(b=>b.classList.remove('active'));if(panel==='catalog'){document.getElementById('catalogPanel').classList.add('active');document.getElementById('tabCatalog').classList.add('active');}if(panel==='add'){document.getElementById('addPanel').classList.add('active');document.getElementById('tabAdd').classList.add('active');}if(panel==='profile'){document.getElementById('profilePanel').classList.add('active');document.getElementById('tabProfile').classList.add('active');}}
document.getElementById('tabCatalog').onclick=()=>show('catalog');document.getElementById('tabAdd').onclick=()=>show('add');document.getElementById('tabProfile').onclick=()=>show('profile');

/* render catalog */
function renderCatalog(){
  const c=document.getElementById('catalog');c.innerHTML='';
  products.forEach(p=>{
    const d=document.createElement('div');d.className='card';d.onclick=()=>openModal(p.id);
    d.innerHTML=`<img src="${p.thumb||''}" class="thumb"><div class="title">${p.title}</div><div class="desc">${p.description||''}</div>`;
    const f=document.createElement('div');f.className='footer';
    const purchased=purchases.some(x=>x.productId===p.id);
    if(p.ownerId===meId){f.innerHTML='<button class="btn btn-mine">Мой товар</button>';}
    else if(purchased){f.innerHTML='<button class="btn btn-owned">Приобретено</button>';}
    else{f.innerHTML='<button class="btn btn-buy">Купить '+fmt(p.price)+'</button>';f.querySelector('button').onclick=(e)=>{e.stopPropagation();openModal(p.id);};}
    d.appendChild(f);c.appendChild(d);
  });
}

/* render profile */
function renderProfile(){
  const pur=document.getElementById('purchases');pur.innerHTML='';
  purchases.forEach(r=>{const p=products.find(x=>x.id===r.productId);if(!p)return;const d=document.createElement('div');d.className='card';d.onclick=()=>openModal(p.id);d.innerHTML=`<img src="${p.thumb||''}" class="thumb"><div class="title">${p.title}</div><div class="desc">${p.description||''}</div><button class="btn btn-owned">Приобретено</button>`;pur.appendChild(d);});
  const mine=document.getElementById('myproducts');mine.innerHTML='';
  products.filter(p=>p.ownerId===meId).forEach(p=>{const d=document.createElement('div');d.className='card';d.onclick=()=>openModal(p.id);d.innerHTML=`<img src="${p.thumb||''}" class="thumb"><div class="title">${p.title}</div><div class="desc">${p.description||''}</div><button class="btn btn-mine">Мой товар</button>`;mine.appendChild(d);});
}

/* modal */
const modal=document.getElementById('modal'),modalImg=document.getElementById('modalImg'),modalTitle=document.getElementById('modalTitle'),modalDesc=document.getElementById('modalDesc'),modalPrice=document.getElementById('modalPrice'),modalActions=document.getElementById('modalActions');
let curId=null;
function openModal(id){
  const p=products.find(x=>x.id===id);if(!p)return;curId=id;
  modalImg.src=p.thumb||'';modalTitle.textContent=p.title;modalDesc.textContent=p.description||'';modalPrice.textContent=fmt(p.price);
  modalActions.innerHTML='';
  const purchased=purchases.some(x=>x.productId===p.id);
  if(p.ownerId===meId){modalActions.innerHTML='<button class="btn btn-mine">Мой товар</button>';if(p.asset){const b=document.createElement('button');b.className='btn';b.textContent='Скачать';b.onclick=()=>{const a=document.createElement('a');a.href=p.asset;a.download=p.assetName||'file';a.click();};modalActions.appendChild(b);}}
  else if(purchased){const b1=document.createElement('button');b1.className='btn btn-owned';b1.textContent='Приобретено';const b2=document.createElement('button');b2.className='btn';b2.textContent='Получить файл';b2.onclick=()=>{if(p.asset){const a=document.createElement('a');a.href=p.asset;a.download=p.assetName||'file';a.click();}else toast('Файл отсутствует');};modalActions.appendChild(b1);modalActions.appendChild(b2);}
  else{const buy=document.createElement('button');buy.className='btn btn-buy';buy.textContent='Купить '+fmt(p.price);buy.onclick=()=>doBuy(p.id);modalActions.appendChild(buy);}
  modal.classList.add('show');
}
document.getElementById('closeModal').onclick=()=>modal.classList.remove('show');
modal.onclick=e=>{if(e.target===modal)modal.classList.remove('show');};

/* buy */
function doBuy(id){const p=products.find(x=>x.id===id);if(!p)return;if(balance<p.price){toast('Недостаточно средств');return;}balance-=p.price;purchases.unshift({productId:p.id});save();updateBal();renderCatalog();renderProfile();toast('Куплено');modal.classList.remove('show');}

/* add */
let thumbData=null,assetData=null,assetName=null;
document.getElementById('thumb').onchange=e=>{const f=e.target.files[0];if(!f)return;const r=new FileReader();r.onload=ev=>{thumbData=ev.target.result;document.getElementById('thumbPreview').innerHTML='<img src="'+thumbData+'">';};r.readAsDataURL(f);}
document.getElementById('asset').onchange=e=>{const f=e.target.files[0];if(!f)return;const r=new FileReader();r.onload=ev=>{assetData=ev.target.result;assetName=f.name;toast('Файл загружен');};r.readAsDataURL(f);}
document.getElementById('price').oninput=e=>{const v=parseFloat(e.target.value)||0;document.getElementById('net').textContent=fmt(v*0.9);}
document.getElementById('publish').onclick=()=>{const title=document.getElementById('title').value.trim(),desc=document.getElementById('desc').value.trim(),price=parseFloat(document.getElementById('price').value);if(!title||!desc||!price){toast('Заполните поля');return;}products.unshift({id:Date.now(),title,description:desc,price,thumb:thumbData,asset:assetData,assetName,ownerId:meId});save();renderCatalog();renderProfile();toast('Опубликовано');};

/* init */
updateBal();renderCatalog();renderProfile();
</script>
</body>
</html>
