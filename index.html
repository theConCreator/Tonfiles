<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>TONFiles Market</title>
<style>
:root {
  --bg: #0f1220;
  --card: #171a2a;
  --text: #e8ebff;
  --muted: #9aa3c7;
  --accent: #6ea8ff;
  --accent-2: #7b6cff;
  --btn: #2a2f45;
  --btn-hover: #343a55;
  --radius: 16px;
  --shadow: 0 6px 20px rgba(0,0,0,0.25);
}

* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: sans-serif;
  background: var(--bg);
  color: var(--text);
  margin: 0;
  overflow-x: hidden;
}
.wrap { max-width: 1000px; margin: 0 auto; padding: 16px; }
h2 { font-size: 20px; margin-bottom: 12px; }

/* Tabs */
nav {
  position: fixed; bottom: 0; left: 0; right: 0;
  background: var(--card);
  display: flex;
  justify-content: space-around;
  padding: 10px 0;
  border-top: 1px solid #222;
  z-index: 999;
}
nav button {
  background: none; border: none; color: var(--text);
  font-size: 14px; cursor: pointer; padding: 8px 12px;
}
nav button.active { color: var(--accent); font-weight: bold; }

.tab { display: none; padding-bottom: 70px; }
.tab.active { display: block; }

/* Grid for products */
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fill,minmax(220px,1fr));
  gap: 16px;
}
.card {
  background: var(--card);
  border-radius: var(--radius);
  padding: 14px;
  box-shadow: var(--shadow);
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
}
.card img {
  max-width: 100%; border-radius: 12px;
  margin-bottom: 10px;
}
.name { font-weight: 600; margin-bottom: 8px; }
.price { color: var(--accent); margin-bottom: 10px; }
.btn {
  padding: 10px 12px;
  border-radius: 12px;
  background: linear-gradient(135deg,var(--accent),var(--accent-2));
  color: white; border: none;
  font-weight: 700; cursor: pointer;
  width: 100%;
}
.btn:disabled {
  background: #2d3b57; cursor: not-allowed;
}
.balance {
  font-size: 16px; font-weight: 600;
  margin-bottom: 16px;
}
.form {
  background: var(--card);
  padding: 16px;
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  display: flex;
  flex-direction: column;
  gap: 12px;
}
.form input, .form textarea {
  padding: 10px;
  border-radius: 10px;
  border: none;
  background: #1e2235;
  color: var(--text);
  width: 100%;
}
.form input[type=file] {
  padding: 6px; background: none;
}
.history-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill,minmax(160px,1fr));
  gap: 12px;
}
.history-card {
  background: var(--card);
  border-radius: var(--radius);
  padding: 10px;
  text-align: center;
}
.history-card img {
  max-width: 100%; border-radius: 10px; margin-bottom: 6px;
}
</style>
</head>
<body>

<main class="wrap">
  <!-- Главная -->
  <section id="home" class="tab active">
    <h2>Товары</h2>
    <div class="balance">Баланс: <span id="balance">1000</span> TON</div>
    <div class="grid" id="productGrid"></div>
  </section>

  <!-- Добавить -->
  <section id="add" class="tab">
    <h2>Добавить товар</h2>
    <form class="form" id="addForm">
      <input type="text" id="title" placeholder="Название" required>
      <textarea id="desc" rows="3" placeholder="Описание"></textarea>
      <input type="number" id="price" placeholder="Цена (TON)" required min="1">
      <input type="file" id="image" accept="image/*">
      <button type="submit" class="btn">Опубликовать</button>
    </form>
  </section>

  <!-- Профиль -->
  <section id="profile" class="tab">
    <h2>История покупок</h2>
    <div class="history-grid" id="historyGrid"></div>
  </section>
</main>

<nav>
  <button data-tab="home" class="active">Главная</button>
  <button data-tab="add">Добавить</button>
  <button data-tab="profile">Профиль</button>
</nav>

<script>
let balance = 1000;
let products = [];
let history = [];

// Переключение вкладок
document.querySelectorAll("nav button").forEach(btn=>{
  btn.addEventListener("click",()=>{
    document.querySelectorAll("nav button").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    document.querySelectorAll(".tab").forEach(tab=>tab.classList.remove("active"));
    document.getElementById(btn.dataset.tab).classList.add("active");
  });
});

// Рендер товаров
function renderProducts(){
  const grid=document.getElementById("productGrid");
  grid.innerHTML="";
  products.forEach((p,i)=>{
    const bought = history.some(h=>h.title===p.title && h.price===p.price);
    const card=document.createElement("div");
    card.className="card";
    if(p.image){ card.innerHTML+=`<img src="${p.image}" alt="">`; }
    card.innerHTML+=`
      <div class="name">${p.title}</div>
      <div class="price">${p.price} TON</div>
      <button class="btn" ${bought?"disabled":""}>
        ${bought?"Куплено":"Купить"}
      </button>`;
    const btn=card.querySelector("button");
    btn.addEventListener("click",()=>{
      if(balance>=p.price){
        balance-=p.price;
        document.getElementById("balance").textContent=balance;
        history.push(p);
        renderProducts(); renderHistory();
      } else { alert("Недостаточно средств"); }
    });
    grid.appendChild(card);
  });
}

// Рендер истории
function renderHistory(){
  const grid=document.getElementById("historyGrid");
  grid.innerHTML="";
  history.forEach(h=>{
    const card=document.createElement("div");
    card.className="history-card";
    if(h.image){ card.innerHTML+=`<img src="${h.image}" alt="">`; }
    card.innerHTML+=`<div>${h.title}</div><div>${h.price} TON</div>`;
    grid.appendChild(card);
  });
}

// Добавление товара
document.getElementById("addForm").addEventListener("submit",e=>{
  e.preventDefault();
  const title=document.getElementById("title").value.trim();
  const desc=document.getElementById("desc").value.trim();
  const price=parseInt(document.getElementById("price").value);
  const file=document.getElementById("image").files[0];
  if(!title||!price) return;

  if(file){
    const reader=new FileReader();
    reader.onload=()=>{
      products.push({title,desc,price,image:reader.result});
      renderProducts();
      e.target.reset();
      alert("Товар добавлен!");
    };
    reader.readAsDataURL(file);
  } else {
    products.push({title,desc,price});
    renderProducts();
    e.target.reset();
    alert("Товар добавлен!");
  }
});

renderProducts(); renderHistory();
</script>
</body>
</html>
