<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>TONFiles Market</title>
<style>
:root {
  --bg: #0b0b0b;
  --surface: #161616;
  --card: #1d1d1d;
  --text: #f0f0f0;
  --muted: #9ca3af;
  --accent: #0eff00;
  --danger: #ff4747;
  --radius: 14px;
  --shadow: 0 6px 20px rgba(0,0,0,0.5);
}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
body {
  background: var(--bg);
  font-family: "Segoe UI", Inter, sans-serif;
  color: var(--text);
  overflow-x:hidden;
}
button,input,textarea{font:inherit;outline:none;border:none}
a{text-decoration:none;color:inherit}

/* HEADER */
.header {
  display:flex;justify-content:space-between;align-items:center;
  padding:12px 18px;
  background:var(--surface);
  border-radius:var(--radius);
  margin:12px;
  box-shadow:var(--shadow);
}
.logo {display:flex;align-items:center;gap:10px}
.logo img{height:36px}
.balance {
  display:flex;align-items:center;gap:6px;
  background:rgba(14,255,0,0.12);
  padding:6px 12px;
  border-radius:999px;
  font-weight:700;
  color:var(--accent);
}

/* TABS */
.tabs {
  display:flex;
  margin:0 12px;
  margin-top:4px;
}
.tab-btn {
  flex:1;
  padding:12px;
  border-radius:var(--radius);
  border:1px solid rgba(255,255,255,0.05);
  background:transparent;
  color:var(--muted);
  font-weight:700;
  cursor:pointer;
  transition:all .2s;
}
.tab-btn.active {
  background:rgba(14,255,0,0.15);
  color:var(--accent);
  border:1px solid rgba(14,255,0,0.3);
}

/* PANELS */
.panel {
  display:none;
  margin:12px;
  padding:16px;
  border-radius:var(--radius);
  background:var(--surface);
  box-shadow:var(--shadow);
}
.panel.active {display:block}

/* GRID */
.grid {
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(240px,1fr));
  gap:14px;
  margin-top:14px;
}

/* CARD */
.card {
  background:var(--card);
  border-radius:var(--radius);
  padding:12px;
  display:flex;
  flex-direction:column;
  gap:8px;
  box-shadow:var(--shadow);
  height:320px;
  transition:transform .15s, box-shadow .15s;
  cursor:pointer;
}
.card:hover {transform:translateY(-4px);box-shadow:0 8px 22px rgba(14,255,0,0.25)}
.thumb {
  width:100%;
  height:150px;
  border-radius:10px;
  object-fit:cover;
  background:#0a0a0a;
}
.title {
  font-weight:700;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.desc {
  font-size:13px;
  color:var(--muted);
  line-height:1.3;
  overflow:hidden;
  display:-webkit-box;
  -webkit-line-clamp:2;
  -webkit-box-orient:vertical;
  word-break:break-word;
}
.meta {font-size:12px;color:var(--muted)}
.footer {
  margin-top:auto;
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}

/* BUTTONS */
.btn {
  flex:1;
  padding:10px;
  border-radius:10px;
  font-weight:700;
  cursor:pointer;
  text-align:center;
  transition:background .2s;
}
.btn-buy {background:var(--accent);color:#000}
.btn-buy:hover {background:#4fff49}
.btn-owned {background:#0bbf44;color:#000}
.btn-ghost {background:transparent;border:1px solid rgba(255,255,255,0.1);color:var(--muted)}
.btn-danger {background:var(--danger);color:#fff}

/* FORMS */
.form {display:flex;flex-direction:column;gap:10px}
.input, textarea {
  padding:10px;
  border-radius:10px;
  background:#0f0f0f;
  color:var(--text);
}
.preview {
  height:140px;
  border-radius:10px;
  background:#0d0d0d;
  display:flex;
  align-items:center;
  justify-content:center;
  color:var(--muted);
  overflow:hidden;
}

/* MODAL */
.modal {
  position:fixed;inset:0;background:rgba(0,0,0,0.75);
  display:none;align-items:center;justify-content:center;
  z-index:999;
}
.modal.show {display:flex}
.modal-card {
  background:var(--card);
  padding:18px;
  border-radius:var(--radius);
  width:95%;max-width:700px;
  box-shadow:var(--shadow);
}
.modal-card img {width:100%;height:250px;object-fit:cover;border-radius:10px}
.modal-info {margin-top:12px}
.modal-info h3 {margin-bottom:6px}
.modal-info p {margin-bottom:6px}
.modal-actions {display:flex;gap:10px;margin-top:12px}

/* TOAST */
.toast {
  position:fixed;bottom:60px;right:18px;
  padding:10px 14px;
  border-radius:10px;
  font-weight:700;
  display:none;
}
.toast.success{background:var(--accent);color:#000}
.toast.error{background:var(--danger)}
.toast.info{background:#2c2c2c}
</style>
</head>
<body>
  <header class="header">
    <div class="logo">
      <img src="tonfiles.svg" alt="logo">
      <strong>TONFiles Market</strong>
    </div>
    <div class="balance" id="balance">1000 TON</div>
  </header>

  <div class="tabs">
    <button class="tab-btn active" id="tabCatalog">Каталог</button>
    <button class="tab-btn" id="tabAdd">Добавить</button>
    <button class="tab-btn" id="tabProfile">Профиль</button>
  </div>

  <!-- Catalog -->
  <section id="panelCatalog" class="panel active">
    <h3>Каталог</h3>
    <div class="grid" id="catalog"></div>
  </section>

  <!-- Add -->
  <section id="panelAdd" class="panel">
    <h3>Добавить товар</h3>
    <div class="form">
      <input id="title" class="input" placeholder="Название">
      <textarea id="description" class="input" placeholder="Описание"></textarea>
      <input id="price" class="input" type="number" step="0.01" placeholder="Цена (TON)">
      <label>Превью: <input type="file" id="thumb" accept="image/*"></label>
      <div id="thumbPreview" class="preview">Нет превью</div>
      <label>Файл: <input type="file" id="asset"></label>
      <button id="publish" type="button" class="btn btn-buy">Опубликовать</button>
    </div>
  </section>

  <!-- Profile -->
  <section id="panelProfile" class="panel">
    <h3>Мои покупки</h3>
    <div class="grid" id="purchases"></div>
    <h3 style="margin-top:16px">Мои товары</h3>
    <div class="grid" id="myProducts"></div>
  </section>

  <!-- Modal -->
  <div class="modal" id="modal">
    <div class="modal-card">
      <img id="modalImg" src="">
      <div class="modal-info">
        <h3 id="modalTitle"></h3>
        <p id="modalDesc"></p>
        <p><b id="modalPrice"></b> TON</p>
        <div class="modal-actions" id="modalActions"></div>
        <button id="closeModal" class="btn btn-ghost" style="margin-top:10px;width:100%">Закрыть</button>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

<script>
/* Storage keys */
const KEY_PRODUCTS="products_v1",KEY_PURCHASES="purchases_v1",KEY_BAL="balance_v1";
let products=JSON.parse(localStorage.getItem(KEY_PRODUCTS)||"[]");
let purchases=JSON.parse(localStorage.getItem(KEY_PURCHASES)||"[]");
let balance=parseFloat(localStorage.getItem(KEY_BAL)||"1000");

/* seed demo product */
if(products.length===0){
  products.push({id:Date.now(),title:"TON Guide",description:"Учебник по TON",price:12.5,thumb:"https://via.placeholder.com/400x300?text=TON",asset:null});
  save();
}

/* helpers */
function save(){localStorage.setItem(KEY_PRODUCTS,JSON.stringify(products));localStorage.setItem(KEY_PURCHASES,JSON.stringify(purchases));localStorage.setItem(KEY_BAL,balance);}
function fmt(n){return Number(n).toFixed(2).replace(/\.00$/,"");}
function toast(type,txt){const t=document.getElementById("toast");t.className="toast "+type;t.textContent=txt;t.style.display="block";setTimeout(()=>t.style.display="none",2000);}
function updateBalance(){document.getElementById("balance").textContent=fmt(balance)+" TON";}

/* render catalog */
function renderCatalog(){
  const el=document.getElementById("catalog");el.innerHTML="";
  products.forEach(p=>{
    const c=document.createElement("div");c.className="card";c.onclick=()=>openModal(p.id);
    c.innerHTML=`<img src="${p.thumb||''}" class="thumb"><div class="title">${p.title}</div><div class="desc">${p.description}</div><div class="meta">Цена: ${fmt(p.price)} TON</div>`;
    const f=document.createElement("div");f.className="footer";
    const purchased=purchases.find(x=>x.productId===p.id);
    if(purchased){f.innerHTML=`<button class="btn btn-owned">Приобретено</button>`;}else{f.innerHTML=`<button class="btn btn-buy">Купить</button>`;f.querySelector("button").onclick=(e)=>{e.stopPropagation();buy(p.id)};}
    c.appendChild(f);el.appendChild(c);
  });
}

/* render profile */
function renderProfile(){
  const buyEl=document.getElementById("purchases");buyEl.innerHTML="";
  purchases.forEach(x=>{
    const p=products.find(pp=>pp.id===x.productId);if(!p)return;
    const c=document.createElement("div");c.className="card";c.onclick=()=>openModal(p.id);
    c.innerHTML=`<img src="${p.thumb||''}" class="thumb"><div class="title">${p.title}</div><div class="desc">${p.description}</div>`;buyEl.appendChild(c);
  });
  const myEl=document.getElementById("myProducts");myEl.innerHTML="";
  products.forEach(p=>{
    const c=document.createElement("div");c.className="card";c.onclick=()=>openModal(p.id);
    c.innerHTML=`<img src="${p.thumb||''}" class="thumb"><div class="title">${p.title}</div><div class="desc">${p.description}</div>`;myEl.appendChild(c);
  });
}

/* buy */
function buy(id){
  const p=products.find(x=>x.id===id);if(!p)return;
  if(balance<p.price){toast("error","Недостаточно средств");return;}
  balance-=p.price;purchases.push({productId:p.id,date:new Date().toLocaleString()});save();updateBalance();renderCatalog();renderProfile();toast("success","Покупка успешна");
}

/* modal */
function openModal(id){
  const p=products.find(x=>x.id===id);if(!p)return;
  document.getElementById("modalImg").src=p.thumb||"";
  document.getElementById("modalTitle").textContent=p.title;
  document.getElementById("modalDesc").textContent=p.description;
  document.getElementById("modalPrice").textContent=fmt(p.price);
  const act=document.getElementById("modalActions");act.innerHTML="";
  const purchased=purchases.find(x=>x.productId===p.id);
  if(purchased){
    act.innerHTML=`<button class="btn btn-owned" style="flex:1">Приобретено</button>
                   <button class="btn btn-ghost" style="flex:1">Получить файл</button>`;
  }
  else {
    const b=document.createElement("button");b.className="btn btn-buy";b.textContent="Купить";b.onclick=()=>buy(p.id);act.appendChild(b);
  }
  document.getElementById("modal").classList.add("show");
}
document.getElementById("closeModal").onclick=()=>document.getElementById("modal").classList.remove("show");

/* add */
let thumbData=null,assetData=null;
document.getElementById("thumb").onchange=e=>{
  const f=e.target.files[0];if(!f)return;
  const r=new FileReader();r.onload=ev=>{thumbData=ev.target.result;document.getElementById("thumbPreview").innerHTML=`<img src="${thumbData}" style="width:100%;height:100%;object-fit:cover">`;};r.readAsDataURL(f);
};
document.getElementById("asset").onchange=e=>{
  const f=e.target.files[0];if(!f)return;
  const r=new FileReader();r.onload=ev=>{assetData=ev.target.result;toast("info","Файл загружен");};r.readAsDataURL(f);
};
document.getElementById("publish").onclick=(e)=>{
  e.preventDefault();
  const title=document.getElementById("title").value,desc=document.getElementById("description").value,price=parseFloat(document.getElementById("price").value);
  if(!title||!desc||!price){toast("error","Заполните поля");return;}
  products.unshift({id:Date.now(),title,description:desc,price,thumb:thumbData,asset:assetData});
  save();renderCatalog();renderProfile();toast("success","Товар добавлен");
};

/* tabs */
function showTab(tab){
  document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("active"));
  document.querySelectorAll(".panel").forEach(p=>p.classList.remove("active"));
  document.getElementById("tab"+tab).classList.add("active");
  document.getElementById("panel"+tab).classList.add("active");
}
document.getElementById("tabCatalog").onclick=()=>showTab("Catalog");
document.getElementById("tabAdd").onclick=()=>showTab("Add");
document.getElementById("tabProfile").onclick=()=>showTab("Profile");

/* init */
updateBalance();renderCatalog();renderProfile();
</script>
</body>
</html>
